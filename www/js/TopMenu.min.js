jQuery(function(){var a=Class.extend({picker:null,minDate:null,maxDate:null,periodSelector:null,dateSelector:null,selectValue:null,period:null,form:null,openEmailExport:function(){$("#dialog-export").dialog("open")},openSupport:function(){$("#dialog-support").dialog()},attachEvents:function(){var a=this;$("a.export").bind("click",function(a){a.preventDefault();boxManager.exportBoxes()});$("a.email").bind("click",function(b){b.preventDefault();a.openEmailExport()});$("#support").bind("click",function(b){b.preventDefault();a.openSupport()});$("#period-selector").selectbox().bind("change",this.wrapper(this.periodHandler,{context:a}));this.form.submit(function(a){a.preventDefault();var b={};var c=$(this).serializeArray();for(var d=0;d<c.length;d++){b[c[d].name]=c[d].value}boxManager.setRange(b);boxManager.clearData();boxManager.refresh()})},initRange:function(){var a=this.form.serializeArray();var b={};for(var c=0;c<a.length;c++){b[a[c].name]=a[c].value}boxManager.setRange(b)},initExport:function(){var a=$("#from"),b=$("#reply"),c=$([]).add(a,b);$("#dialog-export").dialog({autoOpen:false,height:300,width:350,modal:true,buttons:{Send:function(){var d=true;c.removeClass("ui-state-error");d=d&&helpers.checkLength(b,"Send to Email",6,80);d=d&&helpers.checkLength(a,"From Email",6,80);var e=b.val().split(",");d=d&&helpers.checkRegexp(a,a.val(),/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com");for(var f in e){d=d&&helpers.checkRegexp(b,e[f],/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com")}var g=$(this);if(d){helpers.tips.html("Email is sending to recipients, please wait...");a.attr("disabled","disabled");b.attr("disabled","disabled");boxManager.exportBoxes({emails:{from:a.val(),to:e},callback:function(){a.removeAttr("disabled");b.removeAttr("disabled");helpers.tips.html("<strong>Email was sent correctly. This message will close in 2 seconds.</strong>");setTimeout(function(){c.attr("value","");helpers.tips.html("Please provide email addresses you would like to send this report to‭ (‬use commas to send to multiple‭).");g.dialog("close")},3e3)}})}},Cancel:function(){$(this).dialog("close")}},close:function(){c.val("").removeClass("ui-state-error")}})},initialize:function(){this.periodSelector=$("#period-selector");this.dateSelector=$("#date-selector");this.selectValue=this.periodSelector.val();this.period=determineMonthDiff(this.selectValue);this.minDate=this.dateSelector.val();this.form=$("#range-form");this.dateRange=$("#date-range");var a;if(a=Date.parse(this.minDate)){this.minDate=new Date(a)}if(a=Date.parse(this.selectValue)){this.maxDate=new Date(a)}else{switch(this.selectValue){case"ytd":this.maxDate=new Date;this.maxDate.setDate(this.maxDate.getDate()-1);this.minDate.setMonth(0,1);this.minDate.setFullYear(this.maxDate.getFullYear());break;case"all":this.minDate=new Date(1971,1,1);this.maxDate=new Date;this.maxDate.setDate(this.maxDate.getDate()-1);break;default:this.maxDate=new Date(this.minDate);this.maxDate.setMonth(this.maxDate.getMonth()+this.period);break}}formated=[];formated[0]=helpers.getMonthName(this.minDate,true)+" "+this.minDate.getDate()+", "+this.minDate.getFullYear();formated[1]=helpers.getMonthName(this.maxDate,true)+" "+this.maxDate.getDate()+", "+this.maxDate.getFullYear();$("#widgetField span").get(0).innerHTML=formated.join(" - ")},periodHandler:function(a,b){var c=b.context;c.selectValue=$(a.target).val();c.period=determineMonthDiff(c.selectValue);var d;if(d=Date.parse(c.selectValue)){c.maxDate=new Date(d);c.picker.DatePickerSetDate([c.minDate,c.maxDate],true);c.form.trigger("submit");return}else{switch(c.selectValue){case"ytd":c.minDate.setMonth(0,1);c.minDate.setFullYear(c.maxDate.getFullYear());break;case"all":c.minDate=new Date(1971,1,1);break;default:c.minDate=new Date;c.minDate.setMonth(c.minDate.getMonth()-c.period,c.minDate.getDate()-1);c.maxDate=new Date;c.maxDate.setDate(c.maxDate.getDate()-1);break}var e=c.minDate.getMonth()+1+"/"+c.minDate.getDate()+"/"+c.minDate.getFullYear();c.dateSelector.val(e);var f=[];f[0]=helpers.getMonthName(c.minDate,true)+" "+c.minDate.getDate()+", "+c.minDate.getFullYear();f[1]=helpers.getMonthName(c.maxDate,true)+" "+c.maxDate.getDate()+", "+c.maxDate.getFullYear();$("#widgetField span").get(0).innerHTML=f.join(" - ");c.picker.DatePickerSetDate([c.minDate,c.maxDate],false)}c.form.trigger("submit")},wrapper:function(a,b){return function(c){a(c,b)}},initRangeSelect:function(){var a=this;this.picker=$("#widgetCalendar").DatePicker({flat:true,format:"d B, Y",date:[this.minDate,this.maxDate],calendars:2,mode:"range",starts:1,onChange:function(b,c){var d=Math.floor((c[1].getTime()-c[0].getTime())/(1e3*3600*24));if(d){a.minDate=c[0];a.maxDate=c[1];var e=helpers.standardDate(c[0]);var f=helpers.standardDate(c[1]);a.dateSelector.val(e);if(!a.periodSelector.has("option:contains('custom')").length){a.periodSelector.append($(document.createElement("option")).attr("value",f).text("custom"))}a.periodSelector.parents(".jquery-selectbox").unselectbox();a.periodSelector.find("option:contains('custom')").prop("selected","selected");a.periodSelector.selectbox().bind("change",a.wrapper(a.periodHandler,{context:a}));b[0]=helpers.getMonthName(a.minDate,true)+" "+a.minDate.getDate()+", "+a.minDate.getFullYear();b[1]=helpers.getMonthName(a.maxDate,true)+" "+a.maxDate.getDate()+", "+a.maxDate.getFullYear();$("#widgetField span").get(0).innerHTML=b.join(" - ");a.form.trigger("submit");$("#widgetCalendar").stop().animate({height:$("#widgetField>a").hasClass("toggled")?0:$("#widgetCalendar div.datepicker").get(0).offsetHeight},500);$("#widgetField>a").toggleClass("toggled")}},onRender:function(a){var b=new Date;b.setDate(b.getDate()-1);var c=a>b;return{disabled:c}}});$("#widgetField>a").bind("click",function(){$("#widgetCalendar").stop().animate({height:$(this).hasClass("toggled")?0:$("#widgetCalendar div.datepicker").get(0).offsetHeight},500);$(this).toggleClass("toggled");return false})},init:function(){if($("#period-selector").length){this.initialize();this.initRange();this.initRangeSelect();this.initExport();this.attachEvents()}}});a=new a;a.init();boxManager.init()}) 