function Class(){}Class.prototype.construct=function(){};Class.__asMethod__=function(b,a){return function(){var d=this.Super;this.Super=a;var c=b.apply(this,arguments);this.Super=d;return c}};Class.extend=function(e){var a=function(){if(arguments[0]!==Class&&this.construct){this.construct.apply(this,arguments)}};var d=new this(Class);var b=this.prototype;for(var f in e){var c=e[f];if(c instanceof Function){c=Class.__asMethod__(c,b)}d[f]=c}d.Super=b;a.prototype=d;a.extend=this.extend;return a};var boxCollection=new Array();var BoxController=Class.extend({boxId:"",dataProvider:null,data:null,error:null,endpoint:null,filters:{},range:"1m",dateInterval:null,ignore:false,empty:false,noApiUrl:false,template:null,construct:function(){},init:function(){$.ajaxSetup({timeout:10000});if(this.boxId&&this.getContentDom().length){this.refresh();this.attachBoxEvents()}},attachBoxEvents:function(){},getBoxDom:function(){if(!this._boxDom){this._boxDom=$("#"+this.boxId)}return this._boxDom},getContentDom:function(){if(!this._contentDom){this._contentDom=$("#"+this.boxId+" .box-content:first")}return this._contentDom},getHeaderDom:function(){if(!this._headerDom){this._headerDom=$("#"+this.boxId+" .box-header:first")}return this._headerDom},getFiltersDom:function(){if(!this._filterDom){this._filterDom=$("#"+this.boxId+" .box-filters")}return this._filterDom},getLoaderHtml:function(){return $("#ajax-loader-holder").html()},getBoxId:function(){return this.boxId},showContent:function(){this.getContentDom().children(":first").show();return this},showLoader:function(){this.getContentDom().children().hide();this.getContentDom().append(this.getLoaderHtml());return this},hideLoader:function(){this.getBoxDom().find(".ajax-loader").remove();return this},beforeLoadData:function(){this.data=null;this.showLoader();this.getHeaderDom().find(".box-header-right-buttons a").removeClass("active");return this},afterLoadDataCustom:function(){},afterLoadData:function(){this.hideLoader();this.showContent();this.getHeaderDom().find(".box-header-right-buttons a.box-header-button-show-data").addClass("active");if(this.empty){this.showNoData(".data-grid-holder",this.emptyMessage);this.afterLoadDataCustom()}return this},loadDataCallback:function(a){if(!a.hasOwnProperty("loadCallback")){a.loadCallback=function(d,g,c){a.data=d;var b={sites:1,tags:1,reviews:1,socials:1,networks:1,comparision:1,distribution:1,overall:1,current:1};var f={filters:1,pagination:1};for(var e in d){if(e in b){if(d[e]==false){if(!a.template){a.template=a.getContentDom().children(".data-grid-holder").html()}a.empty=true;a.afterLoadData()}else{if(a.template!==null){a.getContentDom().children(".data-grid-holder").html(a.template)}a.empty=false;a.processData();a.afterLoadData()}}else{if(!(e in f)){a.processData();a.afterLoadData()}}}if(!d){a.data=false;a.empty=true;a.emptyMessage="You need to activate Your facebook or twitter account in Account Settings";a.afterLoadData()}}}return a.loadCallback},loadData:function(){this.beforeLoadData();this.dataProvider.setEndpoint(this.endpoint).setDateRange(this.range).setFilters(this.filters).setDateInterval(null).setCallback(this.loadDataCallback(this));this.data=this.dataProvider.fetch();return this.loadDataCallback},setDataProvider:function(a){this.dataProvider=new DataProvider();this.dataProvider.noApiUrl=this.noApiUrl},resetFilters:function(a){this.filters[a]=[]},showNoData:function(f,c){var a=this.getContentDom().find(f).html(""),e,d,b;c=c?c:"Nothing heard through the Grapevine for the date range you selected. \n             Expand your date range to see more data.";if(a.width()>291){d=$("<div/>",{css:{margin:"20px","text-align":"center"}});e=$("<div/>",{css:{background:"url(/images/icons/icons.png) 5px 0px",width:"291px",height:"283px",margin:"auto auto",position:"relative"}});b='<span style="background: #fff; position: absolute; font-size: 10px;\n font-weight: bold; left: 8px; bottom: -9px;">'+c+"</span>"}else{d=$("<div/>",{css:{margin:"5px","text-align":"center"}});e=$("<div/>");b='<span style="font-size: 10px; font-weight: bold; left: 8px; bottom: -9px;">'+c+"</span>"}e.html(b);d.append(e);a.html(d)},addFilter:function(a,d){var c=false;for(var b in this.filters[a]){if(this.filters[a]!==undefined&&this.filters[a][b]==d){this.filters[a].splice(b,1);c=true}}if(!c){if(this.filters[a]===undefined){this.filters[a]=[]}this.filters[a]=[];this.filters[a].push(d)}return this},setRange:function(a){this.range=a;return this},setDateInterval:function(a){this.dateInterval=a;return this},refresh:function(){this.loadData();return this},clearData:function(){this.data=null;return this},genericCallbackEventWrapper:function(b,a){return function(c){b(c,a)}}});var BC_RecentActivity=BoxController.extend({boxId:"box-social-activity-mini",endpoint:"/api/box/social",ignore:true,processRow:function(e,c,d){var b,a;c.children(".date").text(helpers.formatDate(d));a=$("<a/>",{href:e.link,target:"_blank",text:e.message.substr(0,50)+"..."});c.children(".title").html(a);b=$('<a href="#"><span></span></a>').attr("class",e.network);c.children(".network").html(b);c.children(".reply").attr({href:e.link,target:"_blank"});return c},afterLoadDataCustom:function(){if(!this.data){this.getBoxDom().hide()}},processData:function(){var c=this.data.messages,e;content=this.getContentDom().find(".data-grid-holder"),template=content.find(".row:first");content.find(".row").remove();var a=[];for(e in c){a.push(e)}a.sort(function(h,g){return h==g?0:(h>g)?-1:1});for(var b in a){e=a[b];var f=c[e];if(f instanceof Array){for(var d in f){content.append(this.processRow(f[d],template.clone(),e))}}else{content.append(this.processRow(f,template.clone(),e))}}},construct:function(){this.noApiUrl=true}});var BC_GraphBoxController=BoxController.extend({graphData:null,getGraphHolder:function(){if(!this._graphHolder){this._graphHolder=$("#"+this.boxId+"-graph-holder")}return this._graphHolder},init:function(){this.getContentDom().children().hide();this.getContentDom().parent().find(".box-header-button-show-graph").click(this.showGraph);this.getContentDom().parent().find(".box-header-button-show-data").click(this.showData);if(this.getContentDom().length){this.refresh()}},computeDateInterval:function(){var f=this.range.period,e;switch(f){case"1m":e=Math.floor((getPeriodInDays(this.range.period))/6)+1;break;case"3m":e=Math.floor((getPeriodInDays(this.range.period))/6)+3.2;break;case"6m":e=Math.floor((getPeriodInDays(this.range.period))/6)+6.2;break;case"1y":e=Math.floor((getPeriodInDays(this.range.period))/6)+13;break;case"all":var b=new Date();var a=new Date();a.setFullYear(1971,1,1);var c=(b.getTime()-a.getTime())/(1000*3600*24);e=Math.floor(c/6)+(c/30);break;case"ytd":var b=new Date();var a=new Date();a.setMonth(0,1);var c=(b.getTime()-a.getTime())/(1000*3600*24);e=Math.floor(c/6)+(c/31);break;default:var b=new Date(this.range.date);var a=new Date(this.range.period);var c=(a.getTime()-b.getTime())/(1000*3600*24);e=Math.floor(c/6)+(c/31);break}return e},beforeLoadData:function(){this.showLoader();this.getHeaderDom().find(".box-header-right-buttons a").removeClass("active");this.data=null;if(this.graph){this.graph.destroy();this.graph=null;this.graphData=null}},showData:function(){var b=null;if(this instanceof BoxController){b=this.getBoxDom()}else{b=$(this).parents(".box:first")}var c=b.find(".box-content");c.children().hide();b.find(".box-header-button").removeClass("active");var a=b.find(".data-grid-holder");if(!a.is(":visible")){a.show()}b.find(".box-header-button-show-data").addClass("active");return false},showGraph:function(){var b=null;if(this instanceof BoxController){b=this.getBoxDom()}else{b=$(this).parents(".box:first")}var d=b.find(".box-content");d.children().hide();var c=d.find(".graph-holder");var a=boxManager.getBox(b.attr("id"));b.find(".graph-holder").show();a.getHeaderDom().find(".box-header-right-buttons a").removeClass("active").filter(".box-header-button-show-graph").addClass("active");if(!a.graphData){a.loadGraphData()}else{if(c.children().length){c.children().show()}else{a.prepareGraph()}}return false},beforeLoadGraphData:function(){this.getHeaderDom().find(".box-header-right-buttons a").removeClass("active");if(this.graph){this.graph.destroy();this.graph=null}this.graphData=null;this.getGraphHolder().append(this.getLoaderHtml())},processData:function(){this.graphData=this.data;this.afterLoadGraphData()},loadGraphData:function(){this.beforeLoadGraphData();this.graphData=null;this.graphData=this.dataProvider.setEndpoint(this.endpoint).setDateRange(this.range).setFilters(this.filters).setDateInterval(6).setCallback(this.loadDataCallback(this)).fetch();return this},afterLoadGraphData:function(){this.getGraphHolder().children().remove();this.getHeaderDom().find(".box-header-right-buttons a.box-header-button-show-graph").addClass("active");for(var a in this.graphData){}if(!this.graphData[a]){this.getContentDom().find(".graph-holder").html('<p style="margin:5%;">Nothing heard through the Grapevine \nfor the date range you selected. Expand your date range to see more data.</p>').show()}else{this.showGraph()}return this},prepareGraph:function(){alert("'prepareGraph' is not implemented!!!")},clearData:function(){this.data=null;this.graphData=null}});var BC_LinearGraphBoxController=BC_GraphBoxController.extend({series:[],seriesLabels:[],firstTimestamp:null,dayInterval:3600*24,maxValue:null,formatterCallback:null,getFirstDate:function(){if(this.firstTimestamp){return this.firstTimestamp}for(var c in this.graphData){}for(var b in this.graphData[c]){var a=parseInt(b,10);break}a=new Date(a*1000);return this.firstTimestamp=Date.parse(new Date(a.getFullYear(),a.getMonth(),a.getDate()))},populateGraph:function(){alert("Must be implemented in extending class")},reset:function(){this.firstTimestamp=null;this.series=[];this.seriesLabels=[]},prepareGraph:function(){if(!this.graphData){return}this.reset();this.populateGraph();var b=this.boxId+"-graph-holder";var a={chart:{renderTo:b,type:"spline"},title:{text:false},credits:{enabled:false},colors:["#80699B","#AA4643","#4572A7","#89A54E","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"],xAxis:{startOfWeek:0,type:"datetime",labels:{formatter:this.formatterCallback}},yAxis:{title:{text:false,align:"high"},min:0,max:6,endOnTick:false},exporting:{enabled:false},series:this.series,plotOptions:{series:{events:{legendItemClick:function(c){return false}}}}};this.graph=new Highcharts.Chart(a)},construct:function(){}});var BC_Inbox=BoxController.extend({currentPage:1,totalPages:null,limit:10,ignore:false,extraParams:null,getPagerHolder:function(){if(!this._pagerDom){this._pagerDom=$("#"+this.boxId+" .box-pager")}return this._pagerDom},beforeLoadData:function(){this.getContentDom().children().hide();this.getContentDom().append(this.getLoaderHtml());this.getFiltersDom().find(".box-filter").html(this.getLoaderHtml())},attachBoxEvents:function(){var a=this;a.getBoxDom().delegate("a[data-filter-status]","click",function(c){c.preventDefault();var d=$(this).attr("data-filter-status");var b=$(this).parent().attr("class");b=b.replace("box-filter box-filter-","");if($(this).hasClass("show-all")){a.resetFilters(b)}else{a.addFilter(b,d)}a.currentPage=1;a.refresh()});a.getPagerHolder().delegate(".prev, .next","click",function(c){c.preventDefault();var b=false;if($(this).hasClass("next")){if(a.currentPage<a.totalPages){a.currentPage++;b=true}}if($(this).hasClass("prev")){if(a.currentPage>1){a.currentPage--;b=true}}if(b){a.loadData()}});a.getBoxDom().delegate("tr.collapsed","mouseenter mouseleave",function(b){if(b.type=="mouseenter"){a.getBoxDom().find("tr.collapsed .in > a.expand").removeClass("show");$(b.target).find("a.expand").addClass("show")}else{$(b.target).find("a.expand").removeClass("show")}});a.getBoxDom().delegate(".close-button, .save-button","click",function(b){b.preventDefault();$(this).parents("tr.expanded").addClass("hidden-row").prev().removeClass("border")});a.getBoxDom().delegate("table tr[data-row-id].collapsed","click",function(c){c.preventDefault();var b=$(this).next();if(!$(this).hasClass("border")){b.trigger("expand")}else{b.addClass("hidden-row")}$(this).toggleClass("border")})},loadFilters:function(d){var c=this.data.filters[d];var a=0;var f=this.getFiltersDom().find(".box-filter-"+d);f.html("");for(var b in c){if(!c[b].total&&b!="Total"){continue}var e=$('<a href="#" data-filter-status="'+c[b].value+'"></a>');if(c[b].total){e.text(c[b].total+" ")}if(c[b].active==1&&(c[b].total>0||(b=="Total"||b=="All"))){e.addClass("active");a++}if(b=="Total"||b=="All"){e.addClass("show-all")}e.text(e.text()+c[b].value);f.append('<span class="separator">|</span> ');f.append(e)}if(a>1){f.find(".show-all").removeClass("active")}},loadInboxData:function(){alert("You must implement it by yourself")},initFilters:function(){var b=this.data.filters;if(b){for(var a in b){this.loadFilters(a)}}},afterLoadDataCustom:function(){this.initFilters()},processData:function(){this.loadInboxData();this.initFilters();this.initPager()},loadData:function(){this.initEmailExport();this.beforeLoadData();this.dataProvider.setEndpoint(this.endpoint).setDateRange(this.range).setFilters(this.filters).setDateInterval(null).setPage(this.currentPage).setExtraParams(this.extraParams).setLimit(this.limit).setCallback(this.loadDataCallback(this));this.data=this.dataProvider.fetch();return this},initEmailExport:function(){var a=$("#email-export .from"),b=$("#email-export .reply"),c=$([]).add(a,b);$("#email-export").dialog({autoOpen:false,height:300,width:350,modal:true,buttons:{Send:function(){var f=true;c.removeClass("ui-state-error");f=f&&helpers.checkLength(b,"Send to",6,80);f=f&&helpers.checkLength(a,"From Email",6,80);var j=b.val().split(",");f=f&&helpers.checkRegexp(a,a.val(),/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com");for(var g in j){f=f&&helpers.checkRegexp(b,j[g],/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com")}var h=$(this);if(f){a.attr("disabled","disabled");b.attr("disabled","disabled");helpers.tips.html("Email is sending to recipients, please wait...");$.post("/api/box/email/post",{from:a.val(),to:j,data:h.data("post")},function(){a.removeAttr("disabled");b.removeAttr("disabled");helpers.tips.html("<strong>Email was sent correctly . This message will close in 2 seconds.</strong>");setTimeout(function(){c.attr("value","");helpers.tips.html("Please provide email addresses you would like to send this report to (use commas to send to multiple).");h.dialog("close")},3000)})}},Cancel:function(){$(this).dialog("close")}},close:function(){c.val("").removeClass("ui-state-error")}})},initPager:function(){var a=this.data.pagination;this.currentPage=a.page;this.totalPages=a.pagesCount;this.pagerInited=true;if(this.getPagerHolder()){this.getPagerHolder().find(".page").text(a.page);this.getPagerHolder().find(".pageCount").text(a.pagesCount)}return this},expandEndpointCallback:function(b,a){b.preventDefault();var f={};var d=$(b.target).val();f[a.name]=a.split?d.split(","):d;var c=a.endpoint+"/"+a.id;boxManager.genericRequest(c,f)},populateFields:function(c,b){var a=$(b.trContext);b.context.customPopulateFields(c,b);a.find(".action-email").bind("click",function(d){d.preventDefault();if(c.review){$("#email-export").data("post",c.review)}else{$("#email-export").data("post",c.social)}$("#email-export").dialog("open")});b.trContext.prev().find(".expand-preloader").attr("class","expand");a.removeClass("hidden-row")},expandedPopulate:function(b,a){$(b.target).find("*").unbind();a.trContext=$(b.target);a.trContext.prev().find(".expand").attr("class","expand-preloader");a.context.expandedPopulateCallback(a)},expandedPopulateCallback:function(a){alert("not implemented")},construct:function(){}});var BC_CompetitionScore=BoxController.extend({boxId:"box-competition-score",endpoint:"/api/dataProvider/competition/ogsi",populateColumns:function(d,c,e){var b;for(var a in d){b=c.clone();b.text(a);e.append(b)}},addColumn:function(f,g,d,h){var e=g.clone();var j=g.clone();var a=g.clone();e.find(".score").text(parseFloat(f.ogsi.value).toFixed(2)+"%");e.find(".rank").text(f.ogsi.rank.value+" of "+f.ogsi.rank.out);j.find(".score").text(parseFloat(f.rating.value).toFixed(2));j.find(".rank").text(f.rating.rank.value+" of "+f.rating.rank.out);a.find(".score").text(parseInt(f.reviews.value));a.find(".rank").text(f.reviews.rank.value+" of "+f.reviews.rank.out);var c=[e,j,a];var b=0;d.find("tr").each(function(){$(this).append("<td "+(h?'class="even"':"")+">"+c[b++].html()+"</td>")})},filterRowsCallback:function(a){return this.genericCallbackEventWrapper(function(d,c){d.preventDefault();var b=$(d.target).attr("filter");c.table.find("tr."+b).toggleClass("hide");$(d.target).toggleClass("active")},{table:a})},processData:function(){var e=this.getContentDom().find(".data-grid-holder");var h;if(!this.cachedTable){h=e.find("table");this.getBoxDom().delegate("a[filter]","click",this.filterRowsCallback(h));this.cachedTable=h.clone()}else{if(this.cachedTable){e.find("table").remove();h=this.cachedTable.clone();e.append(h);this.getBoxDom().undelegate("a").delegate("a[filter]","click",this.filterRowsCallback(h)).find("a[filter]").removeClass("active").addClass("active")}}var k=h.find("thead tr"),c=h.find("tbody"),g=k.find("th"),f=this.data.ogsi,a=h.find("tbody tr th:nth-child(2)"),d=a.clone(),b=0;a.remove();this.populateColumns(f,g,k);for(var j in f){this.addColumn(f[j],d,c,(b++%2))}},construct:function(){this.noApiUrl=true}});var BC_Scoreboard=BoxController.extend({boxId:"box-ogsi",endpoint:"/api/dataProvider/scoreboard/overall",processData:function(){var b=this.getContentDom(),g=this.data.overall;if(g){b.find(".ogsi-score-value").text(g.ogsi);b.find(".ogsi-rating-value").text(g.rating.score);b.find(".ogsi-rating-stars-on").css("width",(g.rating.score/5)*100+5+"%");b.find(".ogsi-reviews-value").text(g.reviews);b.show();var d=g.rating;var a=b.find(".bar-holder");var h=Math.max(d.negative,d.positive,d.neutral);var f=d.negative+d.positive+d.neutral;var c;if(f){a.show();var e=a.find(".bar-negative");e.children(".bar-value").text("");if(d.negative>0){c=(d.negative/h)*100;if(c>10){e.children(".bar-value").text(d.negative)}}e=a.find(".bar-neutral");e.children(".bar-value").text("");if(d.neutral>0){c=(d.neutral/h)*100;e.css("width",((d.neutral+d.positive)/f)*100+"%");if(c>10){e.children(".bar-value").text(d.neutral)}e.show()}else{if(d.positive>0){e.css("width",((d.positive)/f)*100+"%");e.show()}else{e.hide()}}e=a.find(".bar-positive");e.children(".bar-value").text("");if(d.positive>0){c=(d.positive/h)*100;if(c>10){e.children(".bar-value").text(d.positive)}e.css("width",(d.positive/(d.neutral+d.positive))*100+"%");e.show()}else{e.hide()}}else{a.hide()}}},construct:function(){this.noApiUrl=true}});var BC_StatusUpdate=BoxController.extend({boxId:"box-status-updates",endpoint:"/api/box/auth",attachBoxEvents:function(){var a=this;this.getContentDom().find(".status-updater textarea").charCount({allowed:120,warning:20,submitEnable:this.getContentDom().find(".buttons button")});this.getContentDom().delegate("form#wallPoster","submit",function(c){c.preventDefault();var b=$(c.target).children("textarea.content").attr("disabled","disabled");var d={};d.message=b.val();$($(this).serializeArray()).each(function(){d[this.name]=true});$.post("/api/box/update",d,function(e){}).error(function(){}).complete(function(){b.removeAttr("disabled");b.val("");a.getContentDom().find(".message span").fadeIn();setTimeout(function(){a.getContentDom().find(".message span").fadeOut()},3000)})})},processData:function(){if(!this.data.facebook_page_name&&!this.data.twitter_account){this.getContentDom().find(".status-updater").html('<p class="message">You need to activate Your facebook or twitter account in Account Settings</p>')}if(this.data.facebook_page_name){this.getContentDom().find(".page_name").text(this.data.facebook_page_name)}else{this.getContentDom().find(".facebook_checkbox").remove()}if(this.data.twitter_account){this.getContentDom().find(".twitter_account").text(this.data.twitter_account)}else{this.getContentDom().find(".twitter_checkbox").remove()}},construct:function(){this.noApiUrl=true}});var BC_Photos=BoxController.extend({boxId:"box-photos",endpoint:"photos",processData:function(){},construct:function(){}});var BC_Videos=BoxController.extend({boxId:"box-videos",endpoint:"videos",processData:function(){},construct:function(){}});var BC_ScoreboardCurrent=BoxController.extend({boxId:"box-ogsi-current",endpoint:"/api/dataProvider/scoreboard/current",processData:function(){var m=this.getContentDom(),p=this.data.current,e=p.rating,o=m.find(".bar-holder"),k;if(p){var f=Math.max(e.negative,e.positive,e.negative),l=e.negative+e.positive+e.neutral;var c=getPeriodInDays(this.range.period);var q;if(!c&&this.range.period=="ytd"){var b=new Date();var j=new Date();j.setMonth(0,1);q=Math.ceil((b.getTime()-j.getTime())/(1000*3600*24))}else{if(c){q=c}else{if(this.range.period=="all"){q="All"}else{var a=Date.parse(this.range.date);var d=Date.parse(this.range.period);var h=Math.ceil((d-a)/(1000*3600*24));q=h}}}m.find(".days").text(q);m.find(".ogsi-score-value").text(p.ogsi);m.find(".ogsi-rating-value").text(p.rating.score);m.find(".ogsi-rating-stars-on").css("width",(p.rating.score/5)*100+5+"%");m.find(".ogsi-reviews-value").text(p.reviews);m.show();if(l){o.show();var g=o.find(".bar-negative");g.children(".bar-value").text("");if(e.negative>0){k=(e.negative/f)*100;if(k>5){g.children(".bar-value").text(e.negative)}}g=o.find(".bar-neutral");g.children(".bar-value").text("");if(e.neutral>0){k=(e.neutral/f)*100;if(k>5){g.children(".bar-value").text(e.neutral)}g.css("width",((e.neutral+e.positive)/l)*100+"%");g.show()}else{if(e.positive>0){g.css("width",(e.positive/(l))*100+"%");g.show()}else{g.hide()}}g=o.find(".bar-positive");g.children(".bar-value").text("");if(e.positive>0){k=(e.positive/f)*100;if(k>5){g.children(".bar-value").text(e.positive)}g.css("width",(e.positive/(e.neutral+e.positive))*100+"%");g.show()}else{g.hide()}}else{o.hide()}}},construct:function(){this.noApiUrl=true}});var BC_TagsAnalysis=BC_GraphBoxController.extend({boxId:"box-tags-analysis",endpoint:"/api/dataProvider/reviews/category_breakdown",prepareGraph:function(){if(!this.graphData){return}var d=this.getGraphHolder();var e=d.attr("id");var a={chart:{renderTo:e,margin:[0,0,30,0],defaultSeriesType:"pie"},plotOptions:{pie:{dataLabels:{enabled:false},showInLegend:true},series:{legendItemClick:function(f){f.preventDefault();return false},point:{events:{legendItemClick:function(f){f.preventDefault();return false}}}}},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>: "+this.y+" %"}},title:"",exporting:{enabled:false},credits:{enabled:false},legend:{borderRadius:0},series:[]};var c={type:"pie",name:"Categories",data:[]};for(var b=0;b<this.graphData.length;b++){c.data.push([this.graphData[b].category,parseFloat(this.graphData[b].percent)])}a.series.push(c);this.graph=new Highcharts.Chart(a)},processData:function(){var b=this.data.categories;this.graphData=b;var d=this.getContentDom().find(".data-grid-holder > table");var a=d.find("tbody tr:first").clone();var f=null;d.find("tbody tr").remove();for(var c=0;c<b.length;c++){f=a.clone();for(n in b[c]){var e=b[c][n];if(n=="percent"){e=e+"%"}f.find("td.col-"+n).text(e)}d.find("tbody").append(f)}},construct:function(){this.noApiUrl=true}});var BC_ReviewSites=BC_GraphBoxController.extend({boxId:"box-review-sites",endpoint:"/api/dataProvider/reviews/sites",prepareGraph:function(){var d=this.boxId+"-graph-holder";if(!this.graphData){this.showNoData(".graph-holder");return}var b={chart:{renderTo:d,defaultSeriesType:"bar"},title:{text:""},colors:["#80699B","#AA4643","#4572A7","#89A54E","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"],xAxis:{categories:[],title:{text:""}},yAxis:{min:0,title:{text:"",align:"high"}},plotOptions:{series:{stacking:"normal",events:{legendItemClick:function(e){e.preventDefault();return false}}}},legend:{verticalAlign:"bottom",borderWidth:1,borderRadius:0,backgroundColor:"#FFFFFF",shadow:true},credits:{enabled:false},exporting:{enabled:false},series:[{name:"Negative",data:[],color:"#be1622",shadow:false},{name:"Neutral",data:[],color:"rgb(243,190,0)",shadow:false},{name:"Positive",data:[],color:"#218D48",shadow:false}]};for(var c in this.graphData){var a=this.graphData[c];b.xAxis.categories.push(a.site);b.series[0].data.push(a.negative);b.series[1].data.push(a.neutral);b.series[2].data.push(a.positive)}this.graph=new Highcharts.Chart(b)},processData:function(){var g=this.data.sites,l=this.getContentDom().find(".data-grid-holder > table"),e=l.find("tbody tr:first").clone(),h=null,a=l.find("tfoot tr");this.graphData=g;a.find("th:not(:first)").text("0");l.find("tbody tr").remove();var f=0;for(var d in g){h=e.clone();for(n in g[d]){var k=g[d][n];h.find("td.col-"+n).text(k);if(n!="site"){var j=0;if(n=="average"){j=parseFloat(a.find("th.col-"+n).text());k=parseFloat(k)}else{j=parseInt(a.find("th.col-"+n).text())}a.find("th.col-"+n).text(k+j)}}l.find("tbody").append(h);f++}var b=parseFloat(a.find("th.col-average").text())/f;b=b.toFixed(1);a.find("th.col-average").text(b)},construct:function(){this.noApiUrl=true}});var BC_ReviewInbox=BC_Inbox.extend({boxId:"box-recent-reviews",endpoint:"/api/dataProvider/reviews",alerts:{},dateHelper:function(b){var a=new Date(b*1000);return monthNames[a.getMonth()]+" "+a.getDate()},titleLink:$('<a href="#" class="title"></a>'),expandButton:$('<a href="#" class="expand"></a>'),prepareMessage:function(e,f){e=e.clone();e.addClass("collapsed").attr("data-row-id",f.id);for(var c in f){var g=f[c],b=e.find("td.col-"+c),h;switch(c){case"date":b.text(this.dateHelper(g));break;case"title":h=this.titleLink.clone();var a=Site.check(f.site);if(a){h.prop({href:a,target:"_blank"})}h.text(g?g:"No Title Available");b.find("div.in").html(h).prepend(this.expandButton.clone());break;case"score":b.html($('<div class="reviewRating"><div class="stars-'+g+'-of-5-front"><span style="text-align:center;">'+(g?g+" stars":"No rating")+"</span></div></div>"));break;case"status":g=g.toLowerCase();var d=g in {"new":1,blank:1,"no status":1}?" ":(g=="closed"?" x ":"!");b.html($('<div class="reviewStatus reviewStatus-'+g.replace(" ","-")+'" style="text-align:center;"><span> '+d+" </span></div>"));break;default:b.text(g);break}}return e},customPopulateFields:function(h,g){var d=h.review,f=$(g.trContext),e=f.find(".single-check > input:checkbox"),a=d.status.toLowerCase(),b=f;f.find(".recent-review-status-icon").removeClass("open closed todo").addClass(a);f.find(".review-details-title").text(d.title?d.title:"No Title Available");f.find(".review-details-content").text(d.content);if(d.identity){f.find(".author").text(d.identity)}if(d.link){f.find(".action-review").attr("href",d.link)}else{f.find(".actions-review").remove();var c=Site.check(d.site);if(c){f.find(".actions-reply").attr("href",c);f.find(".actions-reply").show()}else{f.find(".recentReviewDetailsButtons span.man-disabled").remove();f.find(".recentReviewDetailsButtons").prepend('<span class="man-disabled">Management Responses Not Available for this Review Site</span>');f.find(".actions-reply").hide()}}e.prop("checked",false);e.each(function(){if($(this).val()==a){$(this).prop("checked",true)}});e.bind("change",function(){var k=$(this).is(":checked");var j=e.filter(":checked").length;var l=$(this).val();e.attr("disabled","disabled");if(k){e.prop("checked",false);$(this).prop("checked",true);boxManager.genericRequest("/api/dataProvider/reviews/status/"+g.id,{status:l.toUpperCase()},function(){g.context.renderAlerts();f.find(".recent-review-status-icon").removeClass("new closed todo").addClass(l);var m=l=="new"?"&nbsp;":(l=="closed"?" x ":"!");var o=$('<div class="reviewStatus reviewStatus-'+l+'"><span>[ '+m+" ]</span></div>");f.prev().find(".col-status").html(o);e.removeAttr("disabled")})}else{if(!j&&d.score>=3){boxManager.genericRequest("/api/dataProvider/reviews/status/"+g.id,{status:"NEW"},function(){f.find(".recent-review-status-icon").removeClass("new closed todo").addClass("new");a="new";var m=$('<div class="reviewStatus reviewStatus-new"><span>[  ]</span></div>');f.prev().find(".col-status").html(m);e.removeAttr("disabled")})}}});f.find('select[name="category"]').val(d.category).bind("change",g.context.genericCallbackEventWrapper(g.context.expandEndpointCallback,{id:g.id,endpoint:"/api/dataProvider/reviews/category",name:"category",context:g.context}));f.find("input.review-tags").val(d.tags?d.tags.join(","):"").bind("save",g.context.genericCallbackEventWrapper(g.context.expandEndpointCallback,{id:g.id,endpoint:"/api/dataProvider/reviews/tags",name:"tags",context:g.context,split:true}));f.find('textarea[name="notes"]').val(d.notes).bind("save",g.context.genericCallbackEventWrapper(g.context.expandEndpointCallback,{id:g.id,endpoint:"/api/dataProvider/reviews/notes",name:"notes",context:g.context}));f.find(".save-button").bind("click",function(j){$.each(["tags","notes"],function(){b.find("*[name="+this+"]").trigger("save")})})},expandedPopulateCallback:function(a){boxManager.genericRequest("/api/dataProvider/reviews/categories",{},function(c){var b=a.trContext.find(".review-categories").html("");var d=$("<option />");$.each(c.categories,function(e,f){b.append(d.clone().val(e).text(f))});a.customPopulateFields=this.reviewPopulate;boxManager.genericRequest("/api/dataProvider/reviews/expand/"+a.id,{},a.context.genericCallbackEventWrapper(a.context.populateFields,a))})},loadInboxData:function(){var l=this.getContentDom().find(".data-grid-holder table.data-grid");var e=l.find("tbody tr:first").clone().removeClass("odd even border");var k=l.find("tbody:first > tr:last").clone();var h=null;var a=null;l.find("tbody tr").remove();var c=this.data.reviews;for(var d=0;d<c.length;d++){var j=c[d].id,b=c[d].status,g=b.toLowerCase();h=this.prepareMessage(e,c[d]);a=k.clone().attr("data-row-id",j).bind("expand",this.genericCallbackEventWrapper(this.expandedPopulate,{context:this,id:j}));if(d%2){h.addClass("odd")}else{h.addClass("even")}var f=$('<input type="checkbox" name="id[]" value=""  />');f.attr("value",j);h.find("td.col-checkbox").html(f);l.children("tbody").append(h);l.children("tbody").append(a)}this.getContentDom().find(".ajax-loader").remove();this.getContentDom().find(".data-grid-holder").show();if(this.filter=this.getBoxDom().attr("filter")){this.loaded=true}},renderAlerts:function(){var b=$("#alerts .light-box-content");if(!b.length){return}var a=this;$.post("/api/dataProvider/reviews/alerts",{status:"alert"},function(c){a.alerts.alert=c.alerts;$.post("/api/dataProvider/reviews/alerts",{status:"todo"},function(e){a.alerts.todo=e.alerts;if(a.alerts.alert!==null){for(var d in a.alerts){b.find(".desc ."+d).text(a.alerts[d])}b.parent().removeClass("hide")}})})},initBoxEvents:function(){this.renderAlerts();$("#alerts a.alert-show, #alerts a.todo-show").bind("click",function(b){b.preventDefault();var a="width=800,height=600,menubar=no,location=no,resizable=no,scrollbars=yes,status=no";window.open(this.href,"alerts",a)})},construct:function(){this.noApiUrl=true;if(this.filter=this.getBoxDom().attr("filter")){var b=new Date();this.addFilter("status",this.filter);this.setRange({period:this.getBoxDom().attr("period"),date:this.getBoxDom().attr("date")});this.extraParams={include_date:false};var a=this;this.getBoxDom().resize(function(c){if(a.loaded){$(".window-close").css("top",a.getBoxDom().height()+35)}});$(".window-close").bind("click",function(){window.close()})}this.initBoxEvents()}});var BC_SocialActivity=BC_GraphBoxController.extend({boxId:"box-social-activity",endpoint:"/api/dataProvider/socials/activity",prepareGraph:function(){if(!this.graphData){return}var f=this.boxId+"-graph-holder",b=[],l=this,o=function(q,p,r,c){l.graph.xAxis[0].setCategories(p);l.graph.series[0].remove();l.graph.addSeries({name:q,data:r,color:c||"white"})},h=[],a=Highcharts.getOptions().colors,d=0;for(var k in this.graphData){h.push(this.graphData[k].network);var e=[],j=[];for(var g in this.graphData[k].categories){e.push(g);j.push(this.graphData[k].categories[g])}b.push({y:this.graphData[k].total,color:a[d],drilldown:{name:this.graphData[k].network,categories:e,data:j,color:a[d++]}})}var m={chart:{renderTo:f,type:"bar"},title:{text:false},xAxis:{categories:h,title:{text:""}},yAxis:{min:0,title:{text:false}},legend:{enabled:false},credits:{enabled:false},plotOptions:{bar:{cursor:"pointer",point:{events:{click:function(){var c=this.drilldown;if(c){o(c.name,c.categories,c.data,c.color)}else{o(false,h,b)}}}},dataLabels:{enabled:true,style:{fontWeight:"bold"},formatter:function(){return this.y}}}},tooltip:{formatter:function(){var c=this.point,p=this.x+":<b>"+this.y+" actions</b><br/>";if(c.drilldown){p+="Click to view details"}else{p+="Click to return to overall graph"}return p}},series:[{data:b}],exporting:{enabled:false}};this.graph=new Highcharts.Chart(m)},processData:function(){var g=this.data.networks,d=this.getContentDom().find(".data-grid-holder > table"),a=d.find("tbody tr:first").clone(),f=null;this.graphData=g;trFooter=d.find("tfoot tr");trFooter.find("th.col-total").text("0");d.find("tbody tr").remove();for(var b=0;b<g.length;b++){f=a.clone();for(n in g[b]){var e=g[b][n];f.find("td.col-"+n).text(e);if(n!="network"){var c=0;if(n=="average"){c=parseFloat(trFooter.find("th.col-"+n).text())}else{c=parseInt(trFooter.find("th.col-"+n).text())}trFooter.find("th.col-"+n).text(parseInt(e)+c)}}if(b%2){f.addClass("even")}else{f.addClass("odd")}d.find("tbody").append(f)}},construct:function(){this.noApiUrl=true}});var BC_SocialSubscribers=BC_GraphBoxController.extend({boxId:"box-social-reach",endpoint:"/api/dataProvider/socials/subscribers",prepareGraph:function(){if(!this.graphData){return}var f=this.boxId+"-graph-holder",b=[],l=this,o=function(q,p,r,c){l.graph.xAxis[0].setCategories(p);l.graph.series[0].remove();l.graph.addSeries({name:q,data:r,color:c||"white"})},h=[],a=Highcharts.getOptions().colors,d=0;for(var k in this.graphData){h.push(this.graphData[k].network);var e=[],j=[];for(var g in this.graphData[k].categories){e.push(g);j.push(this.graphData[k].categories[g])}b.push({y:this.graphData[k].total,color:a[d],drilldown:{name:this.graphData[k].network,categories:e,data:j,color:a[d++]}})}var m={chart:{renderTo:f,type:"bar"},title:{text:false},xAxis:{categories:h,title:{text:""}},yAxis:{min:0,title:{text:false}},legend:{enabled:false},credits:{enabled:false},plotOptions:{bar:{cursor:"pointer",point:{events:{click:function(){var c=this.drilldown;if(c){o(c.name,c.categories,c.data,c.color)}else{o(false,h,b)}}}},dataLabels:{enabled:true,style:{fontWeight:"bold"},formatter:function(){return this.y}}}},tooltip:{formatter:function(){var c=this.point,p=this.x+":<b>"+this.y+" actions</b><br/>";if(c.drilldown){p+="Click to view details"}else{p+="Click to return to overall graph"}return p}},series:[{data:b}],exporting:{enabled:false}};this.graph=new Highcharts.Chart(m)},processData:function(){var e=this.getContentDom().find(".data-grid-holder > table"),h=this.data.networks,a=e.find("tbody tr:first").clone(),g=null,b=e.find("tfoot tr");this.graphData=h;b.find(".col-value, .col-total").text("0");e.find("tbody tr").remove();for(var c=0;c<h.length;c++){g=a.clone();for(n in h[c]){var f=h[c][n];if(n=="change"){f=f+"%"}else{if(n=="value"||n=="total"){var d=0;d=parseFloat(b.find("th.col-"+n).text());b.find("th.col-"+n).text(f+d)}}g.find("td.col-"+n).text(f)}if(c%2){g.addClass("even")}else{g.addClass("odd")}e.find("tbody").append(g)}},construct:function(){this.noApiUrl=true}});var BC_CompetitionReviewInbox=BC_Inbox.extend({boxId:"box-competition-review-inbox",endpoint:"/api/dataProvider/competition",prepareMessage:function(h,j){h=h.clone();var e=parseInt(j.id);h.addClass("collapsed").attr("data-row-id",e);for(key in j){var g=j[key];var b=h.find("td.col-"+key);var f;switch(key){case"date":var c=new Date(g*1000);var d=monthNames[c.getMonth()]+" "+c.getDate();b.text(d);break;case"title":f=$('<a href="#" class="title"></a>');f.text(g?g:"No Title Available");var a=Site.check(j.site);if(a){f.prop({href:a,target:"_blank"})}b=b.find("div.in");b.html(f);b.prepend('<a href="#" class="expand"></a>');break;case"score":b.html($('<div class="reviewRating"><div class="stars-'+g+'-of-5-front"><span style="text-align:center;">'+(g?g+" stars":"No rating")+"</span></div></div>"));break;default:b.text(g);break}}return h},customPopulateFields:function(d,c){var a=d.review;var b=$(c.trContext);b.find(".details-title").text(a.title?a.title:"No Title Available");b.find(".details-content").text(a.content);if(a.link!==undefined){b.find(".goto-link").attr("href",a.link)}else{b.find(".goto").remove()}if(a.identity){b.find(".author").text(a.identity)}b.find(".actions-network").remove()},expandedPopulateCallback:function(a){boxManager.genericRequest("/api/dataProvider/competition/expand/"+a.id,{},a.context.genericCallbackEventWrapper(a.context.populateFields,a))},loadInboxData:function(){var j=this.getContentDom().find(".data-grid-holder table.data-grid");var d=j.find("tbody tr:first").clone().removeClass("odd even border");var h=j.find("tbody:first > tr:last").clone();var f=null;var a=null;j.find("tbody tr").remove();var b=this.data.reviews;for(var c=0;c<b.length;c++){var g=b[c].id;a=h.clone().attr("data-row-id",g).bind("expand",this.genericCallbackEventWrapper(this.expandedPopulate,{context:this,id:g}));f=this.prepareMessage(d,b[c]);if(c%2){f.addClass("even")}else{f.addClass("odd")}var e=$('<input type="checkbox" name="id[]" value=""  />');e.attr("value",b[c].id);f.find("td.col-checkbox").html(e);j.find("tbody").append(f,a)}this.getContentDom().find(".ajax-loader").remove();this.getContentDom().find(".data-grid-holder").show()},construct:function(){this.noApiUrl=true}});var BC_CompetitionComparision=BC_LinearGraphBoxController.extend({boxId:"box-competition-comparision",series:[],endpoint:"/api/dataProvider/competition/comparsion",seriesLabels:[],firstTimestamp:null,pointInterval:null,scaleFactor:null,dayInterval:3600*24,formatterCallback:function(){var a;var b=boxManager.getBox("box-competition-comparision");switch(b.range.period){case"1m":a="%a %e";break;case"3m":a="%d %b";break;case"6m":a="%d %b";break;case"1y":a="%b %Y";break;default:a="%a %e";break}return Highcharts.dateFormat(a,this.value)},populateGraph:function(){var g=[];var f=false;this.series=[];var h;var b=[];for(timestamp in this.graphData.comparision){b.push(parseInt(timestamp))}b.sort(function(k,j){return k==j?0:((k<j)?1:-1)});for(var d in b){var e=this.graphData.comparision[b[d]];for(var a in e){var c=e[a];if(!f){g[c.competition]=this.series.length;this.series.push({name:c.competition,data:[],pointStart:this.getFirstDate(),pointInterval:(this.computeDateInterval())*this.dayInterval*1000})}h=parseFloat(c.value);this.maxValue=this.maxValue<h?h:this.maxValue;this.series[g[c.competition]].data.unshift(h)}if(!f){f=true}}},loadData:function(){this.loadGraphData()},construct:function(){this.noApiUrl=true}});var BC_CompetitionDistribution=BC_GraphBoxController.extend({boxId:"box-competition-distribution",endpoint:"/api/dataProvider/competition/distribution",prepareGraph:function(){if(!this.data){return}var e=this.boxId+"-graph-holder";var c=$("#"+e);var a={chart:{renderTo:e,defaultSeriesType:"bar"},title:"",xAxis:{categories:[],title:{text:""}},yAxis:{min:0,title:{text:""}},plotOptions:{series:{stacking:"normal",events:{legendItemClick:function(f){return false}}}},legend:{verticalAlign:"bottom",borderWidth:1,borderRadius:0,backgroundColor:"#FFFFFF",shadow:true},credits:{enabled:false},exporting:{enabled:false},series:[{name:"Negative",data:[],color:"#be1622",shadow:false},{name:"Neutral",data:[],color:"rgb(243,190,0)",shadow:false},{name:"Positive",data:[],color:"#218D48",shadow:false}]};for(var b in this.graphData){var d=this.graphData[b];a.xAxis.categories.push(b);a.series[0].data.push(d.negative);a.series[1].data.push(d.neutral);a.series[2].data.push(d.positive)}this.graph=new Highcharts.Chart(a)},processData:function(){var g=0,b=this.data.distribution,l=this.getContentDom().find(".data-grid-holder > table"),f=l.find("tbody tr:first").clone(),h=null,a=l.find("tfoot tr");this.graphData=b;a.find("th:not(:first)").text("0");l.find("tbody tr").remove();for(var e in b){h=f.clone();for(n in b[e]){var k=b[e][n];h.find("td.col-"+n).text(k);var j=0;if(n=="average"){j=parseFloat(a.find("th.col-"+n).text())}else{j=parseInt(a.find("th.col-"+n).text())}a.find("th.col-"+n).text(parseFloat(k)+j);h.find("td.col-dealership").text(e)}l.find("tbody").append(h);g++}var d=parseFloat(a.find("th.col-average").text())/g;d=d.toFixed(2);a.find("th.col-average").text(d)},construct:function(){this.noApiUrl=true}});var BC_SocialMediaInbox=BC_Inbox.extend({boxId:"box-social-media-inbox",endpoint:"/api/dataProvider/socials",prepareMessage:function(c,d){c=c.clone();c.addClass("collapsed").attr("data-row-id",d.id);for(key in d){var f=d[key];var b=c.find("td.col-"+key);var g;switch(key){case"date":var a=new Date(f*1000);var e=monthNames[a.getMonth()]+" "+a.getDate();b.text(e);break;case"title":g=$('<a href="#" class="title"></a>');g.text(f?f:"No Title Available");b=b.find("div.in");b.html(g);b.prepend('<a href="#" class="expand"></a>');break;case"network":g=$('<a href="#"><span>'+f.toLowerCase()+"</span></a>");g.attr("class",f.toLowerCase());g.filter("span").text(f);b.html(g);break;default:b.text(f);break}}return c},customPopulateFields:function(e,c){var a=e.social;var b=$(c.trContext);var d;if(a.link){d=$("<a/>",{href:a.link,text:a.title?a.title:"No Title Available"})}else{d=a.title?a.title:"No Title Available"}b.find(".details-title").html(d);b.find(".details-content").text(a.content);b.find(".details-network").addClass(a.network.toLowerCase());if(a.identity){b.find(".author").text(a.identity)}if(a.link!==undefined){b.find(".goto-link").attr("href",a.link)}else{b.find(".goto").remove()}},expandedPopulateCallback:function(a){boxManager.genericRequest("/api/dataProvider/socials/expand/"+a.id,{},a.context.genericCallbackEventWrapper(a.context.populateFields,a))},loadInboxData:function(){var j=this.getContentDom().find(".data-grid-holder table.data-grid");var d=j.find("tbody tr:first").clone().removeClass("odd even border");var h=j.find("tbody:first > tr:last").clone();var f=null;var a=null;j.find("tbody tr").remove();var b=this.data.socials;for(var c=0;c<b.length;c++){var g=b[c].id;a=h.clone().attr("data-row-id",g).bind("expand",this.genericCallbackEventWrapper(this.expandedPopulate,{context:this,id:g}));f=this.prepareMessage(d,b[c]);if(c%2){f.addClass("odd")}else{f.addClass("even")}var e=$('<input type="checkbox" name="id[]" value=""  />');e.attr("value",b[c].id);f.find("td.col-checkbox").html(e);j.children("tbody").append(f);j.children("tbody").append(a)}},construct:function(){this.noApiUrl=true}});boxManager={collection:{},section_id:null,dataProvider:null,range:null,positions:null,exporter:null,add:function(a){if((a instanceof BoxController)&&a.getBoxId()&&a.endpoint&&a.getContentDom().length){if(!a.dataProvider&&this.dataProvider){a.setDataProvider(this.dataProvider)}this.collection[a.getBoxId()]=a}else{delete a}return this},getBox:function(a){if(this.collection[a]){return this.collection[a]}return false},droppable:function(a){return{accept:a,activeClass:"box-dropable",hoverClass:"box-drag-over",drop:function(c,d){var h=$(this),f=d.draggable.parent(),e={},g=$(this).attr("id"),b=f.attr("id");if(h.children().length>0){e[b]={box_id:$(h).children().attr("id"),location_id:1,box_class:f.attr("class")};e[g]={box_id:$(d.draggable).attr("id"),location_id:1,box_class:$(this).attr("class")};f.append(h.children())}else{e[g]={holder_id:g,box_id:$(d.draggable).attr("id"),location_id:1,box_class:$(this).attr("class"),section_id:boxManager.section_id};f.addClass("empty").removeClass("active")}$(this).append(d.draggable);$(this).removeClass("empty").addClass("active");if(!boxManager.positions[g]){e[g].delete_previous=true}boxManager.genericRequest("/api/box/move",$.param({holders:e}))}}},initDragAndDrop:function(){var a=this;$("#boxes-holder .box").draggable({snap:".box-container",snapMode:"inner",handle:".box-header-button-move",cursor:"move",helper:function(){return $("<div />",{css:{width:$(this).width()-14,background:"#fff",padding:"10px",border:"1px solid gray","font-size":"14px","font-weight":"bold",height:"30px"}}).text($(this).find(".box-header-title").text())},appendTo:"body",zIndex:10,start:function(c,d){var b=$(this).parent().is(".box-container-left, .box-container-right")?$(".box-container.empty.box-container-left, .box-container.empty.box-container-right"):$(".box-container.empty").not(".box-container-left, .box-container.empty.box-container-right");b.addClass("box-dropable")},stop:function(b,c){$(this).css({bottom:0,left:0,width:"auto"});$(".box-container.empty").removeClass("box-dropable")}});$(".box-container").each(function(){var b=$(this).is(".box-container-left, .box-container-right")?".box-container.box-container-left .box, .box-container.box-container-right .box":".box-container:not(.box-container-left, .box-container-right) .box";if(!$(this).children().length){$(this).removeClass("active").addClass("empty")}$(this).droppable(a.droppable(b))})},genericRequest:function(b,a,c){$.ajax({type:"POST",accepts:"application/json; charset=utf-8",data:a,dataType:"json",url:b,success:c})},initHolders:function(){var a=this,b={};b.holders=[];$(".box-container").each(function(){var c=a.section_id+"-"+$(this).index();$(this).addClass("hide");$(this).attr("id",c);if($(this).is(":parent")){b.holders.push({holder_id:this.id,box_id:$(this).find(".box").attr("id"),location_id:1,section_id:a.section_id,box_class:$(this).attr("class")})}});if($("#boxes-holder").length){this.genericRequest("/api/box/positions/"+this.section_id,$.param(b),function(k){a.positions=k;var c={};for(var h in k){var d=k[h],l=a.collection[d.box_id];if(!l){return}c[d.box_id]=true;box_holder=l.getBoxDom().parent();holder_id=box_holder.attr("id");if(holder_id!=d.holder_id){var f=$("#"+d.holder_id);var g=f.children();f.html(l.getBoxDom());f.removeClass("empty").addClass("active");box_holder.html(g)}l.init()}for(var e in boxManager.collection){if(c[e]){continue}boxManager.collection[e].init()}a.initDragAndDrop();$(".box-container").removeClass("hide")})}},init:function(){this.section_id=$(".top-menu-item.active").text().toLowerCase().replace(/\s+/g,"_");this.initHolders();return this},moveEmptyToBottom:function(){var b=$("#boxes-holder");var a=$("#boxes-holder .box-container");a.each(function(c){var e=$(this);if(!e.children().length){if(e.hasClass("box-container-left")&&!e.next().hasClass("active")){var d=e.next();d.next(".clear").remove();b.append(e).append(d);b.append('<div class="clear"></div>')}else{if(!e.hasClass("box-container-left")&&!e.hasClass("box-container-right")){e.nextAll(":last").after(e)}}}});return this},refresh:function(){for(i in this.collection){this.collection[i].refresh()}return this},setDataProvider:function(b){this.dataProvider=b;for(var a in this.collection){this.collection[a].setDataProvider(b)}return this},setExporter:function(a){this.exporter=a;return this},setFilter:function(a){for(i in this.collection){this.collection[i].setFilter(a)}return this},setRange:function(a){this.range=a;for(i in this.collection){this.collection[i].setRange(this.range)}return this},setDateInterval:function(a){for(i in this.collection){this.collection[i].setDateInterval(a)}return this},clearData:function(){for(i in this.collection){this.collection[i].clearData()}return this},exportBoxes:function(a){if(!a){a=null}$("#boxes-holder .box-container .box").each(function(){var d,g,f=boxManager.getBox(this.id);if(!f||f.ignore){return}if(!f.getBoxDom().parent().is(".box-container-left, .box-container-right")){d=Exporter.template.blockWide.clone()}else{d=Exporter.template.block.clone().addClass(f.getBoxDom().parent().attr("class"))}if(f.hasOwnProperty("graph")&&(f.getHeaderDom().find(".box-header-button-show-graph.active").length||f.getContentDom().children().length==1)){var j=d.clone();var b=f.graph.getSVG();var e=$("<h2/>").text(f.getHeaderDom().find(".box-header-title").text());e.add(b).appendTo(j.find(".inner"));j.appendTo(boxManager.exporter.template.container)}else{g=f.getContentDom().find(".data-grid-holder table:visible:first").clone();if(!g.length&&this.id=="box-ogsi"){g=f.getBoxDom().clone();g.find(".box-header").remove()}switch(this.id){case"box-competition-review-inbox":var c="<thead><tr><th>Rating</th><th>Date</th><th>Review Title</th><th>Source</th><th>Competitor</th></tr></thead>";g.prepend(c);break;case"box-recent-reviews":var c="<thead><tr><th>Status</th><th>Rating</th><th>Date</th><th>Title</th><th>Source</th></tr></thead>";g.prepend(c);d.prepend(f.getContentDom().find(".legend table").clone());break;case"box-social-media-inbox":var c="<thead><tr><th>Network</th><th>Date</th><th>Title</th><th>Site</th></tr></thead>";g.prepend(c);var k=g.find("a.title");k.replaceWith(k.html());k=g.find(".col-network a");k.replaceWith(k.html());break}g.find("tr.expanded").remove();g.find("td").removeAttr("style");if(g.length){var h=$("<h2/>").text(f.getHeaderDom().find(".box-header-title").text());h.add(g).appendTo(d.find(".inner"));d.appendTo(boxManager.exporter.template.container);if(f.getBoxDom().parent().is(".box-container-right")){$('<div class="clear"/>').appendTo(boxManager.exporter.template.container)}}}});boxManager.exporter.submit(a)}};var Exporter={options:{action:"/api/box/export",width:380},template:{block:$('<div class="block"><div class="inner"></div></div>'),blockWide:$('<div class="block2"><div class="inner"></div></div>'),container:$('<div id="page"></div>')},submit:function(e){var c=Highcharts;var a=this;var b=c.merge(this.options,c.getOptions()["exporting"]);var d=c.createElement("form",{method:"POST",action:b.action},{display:"NONE"},document.body);c.createElement("input",{type:"HIDDEN",name:"html",value:a.template.container.html()},null,d);if(e&&e.emails){$.post("/api/box/export",{html:a.template.container.html(),email:e.emails},function(){e.callback()})}else{d.submit()}c.discardElement(d);this.template.container=$('<div id="page"></div>')}};Site={sites:[],init:function(){this.sites.push({site:"dealerrater.com",isResponse:true,url:"http://www.dealerrater.com/login.aspx"});this.sites.push({site:"mydealerreport.com",isResponse:true,url:"http://www.mydealerreport.com/dealers/index.php"});this.sites.push({site:"edmunds.com",isResponse:true,url:"http://www.edmunds.com/era/secure/lb/login.jsp?toUrl=http%3A%2F%2Fwww.edmunds.com%2F"});this.sites.push({site:"maps.google.com",isResponse:true,url:"https://www.google.com/accounts/ServiceLogin?service=lbc"});this.sites.push({site:"citysearch.com",isResponse:true,url:"http://www.citysearch.com/members/start"});this.sites.push({site:"insiderpages.com",isResponse:true,url:"http://www.insiderpages.com/session/new?header_link=true"});this.sites.push({site:"local.yahoo.com",isResponse:true,url:"https://login.yahoo.com/"});this.sites.push({site:"judysbook.com",isResponse:true,url:"http://www.judysbook.com/login"});this.sites.push({site:"yp.com",isResponse:true,url:"http://www.yellowpages.com/oauth/login?url=%2Flogin_success"});this.sites.push({site:"yelp.com",isResponse:true,url:"https://www.yelp.com/login"});this.sites.push({site:"tripadvisor.com",isResponse:true,url:"http://www.tripadvisor.com/"});this.sites.push({site:"urbanspoon.com",isResponse:true,url:"http://www.urbanspoon.com/u/signin?"});this.sites.push({site:"zagat.com",isResponse:false,url:""})},check:function(b){if(!this.sites.length){this.init()}for(var c=0,a=this.sites.length;c<a;c++){if(this.sites[c].site==b){return this.sites[c].isResponse?this.sites[c].url:false}}return false}};