function Class(){}Class.prototype.construct=function(){};Class.__asMethod__=function(a,b){return function(){var c=this.Super;this.Super=b;var d=a.apply(this,arguments);this.Super=c;return d}};Class.extend=function(a){var b=function(){if(arguments[0]!==Class&&this.construct){this.construct.apply(this,arguments)}};var c=new this(Class);var d=this.prototype;for(var e in a){var f=a[e];if(f instanceof Function){f=Class.__asMethod__(f,d)}c[e]=f}c.Super=d;b.prototype=c;b.extend=this.extend;return b};var boxCollection=new Array;var BoxController=Class.extend({boxId:"",dataProvider:null,data:null,error:null,endpoint:null,filters:{},range:"1m",dateInterval:null,ignore:false,empty:false,noApiUrl:false,template:null,construct:function(){},init:function(){$.ajaxSetup({timeout:1e4});if(this.boxId&&this.getContentDom().length){this.refresh();this.attachBoxEvents()}},attachBoxEvents:function(){},getBoxDom:function(){if(!this._boxDom){this._boxDom=$("#"+this.boxId)}return this._boxDom},getContentDom:function(){if(!this._contentDom){this._contentDom=$("#"+this.boxId+" .box-content:first")}return this._contentDom},getHeaderDom:function(){if(!this._headerDom){this._headerDom=$("#"+this.boxId+" .box-header:first")}return this._headerDom},getFiltersDom:function(){if(!this._filterDom){this._filterDom=$("#"+this.boxId+" .box-filters")}return this._filterDom},getLoaderHtml:function(){return $("#ajax-loader-holder").html()},getBoxId:function(){return this.boxId},showContent:function(){this.getContentDom().children(":first").show();return this},showLoader:function(){this.getContentDom().children().hide();this.getContentDom().append(this.getLoaderHtml());return this},hideLoader:function(){this.getBoxDom().find(".ajax-loader").remove();return this},beforeLoadData:function(){this.data=null;this.showLoader();this.getHeaderDom().find(".box-header-right-buttons a").removeClass("active");return this},afterLoadDataCustom:function(){},afterLoadData:function(){this.hideLoader();this.showContent();this.getHeaderDom().find(".box-header-right-buttons a.box-header-button-show-data").addClass("active");if(this.empty){this.showNoData(".data-grid-holder",this.emptyMessage);this.afterLoadDataCustom()}return this},loadDataCallback:function(a){if(!a.hasOwnProperty("loadCallback")){a.loadCallback=function(b,c,d){a.data=b;var e={sites:1,tags:1,reviews:1,socials:1,networks:1,comparision:1,distribution:1,overall:1,current:1};var f={filters:1,pagination:1};for(var g in b){if(g in e){if(b[g]==false){if(!a.template){a.template=a.getContentDom().children(".data-grid-holder").html()}a.empty=true;a.afterLoadData()}else{if(a.template!==null){a.getContentDom().children(".data-grid-holder").html(a.template)}a.empty=false;a.processData();a.afterLoadData()}}else{if(!(g in f)){a.processData();a.afterLoadData()}}}if(!b){a.data=false;a.empty=true;a.emptyMessage="You need to activate Your facebook or twitter account in Account Settings";a.afterLoadData()}}}return a.loadCallback},loadData:function(){this.beforeLoadData();this.dataProvider.setEndpoint(this.endpoint).setDateRange(this.range).setFilters(this.filters).setDateInterval(null).setCallback(this.loadDataCallback(this));this.data=this.dataProvider.fetch();return this.loadDataCallback},setDataProvider:function(a){this.dataProvider=new DataProvider;this.dataProvider.noApiUrl=this.noApiUrl},resetFilters:function(a){this.filters[a]=[]},showNoData:function(a,b){var c=this.getContentDom().find(a).html(""),d,e,f;b=b?b:"Nothing heard through the Grapevine for the date range you selected. \n\n             Expand your date range to see more data.";if(c.width()>291){e=$("<div/>",{css:{margin:"20px","text-align":"center"}});d=$("<div/>",{css:{background:"url(/images/icons/icons.png) 5px 0px",width:"291px",height:"283px",margin:"auto auto",position:"relative"}});f='<span style="background: #fff; position: absolute; font-size: 10px;\n\n font-weight: bold; left: 8px; bottom: -9px;">'+b+"</span>"}else{e=$("<div/>",{css:{margin:"5px","text-align":"center"}});d=$("<div/>");f='<span style="font-size: 10px; font-weight: bold; left: 8px; bottom: -9px;">'+b+"</span>"}d.html(f);e.append(d);c.html(e)},addFilter:function(a,b){var c=false;for(var d in this.filters[a]){if(this.filters[a]!==undefined&&this.filters[a][d]==b){this.filters[a].splice(d,1);c=true}}if(!c){if(this.filters[a]===undefined)this.filters[a]=[];this.filters[a].push(b)}return this},setRange:function(a){this.range=a;return this},setDateInterval:function(a){this.dateInterval=a;return this},refresh:function(){this.loadData();return this},clearData:function(){this.data=null;return this},genericCallbackEventWrapper:function(a,b){return function(c){a(c,b)}}});var BC_RecentActivity=BoxController.extend({boxId:"box-social-activity-mini",endpoint:"/api/box/social",limit:4,ignore:true,processRow:function(a,b,c){var d,e;b.children(".date").text(helpers.formatDate(c));e=$("<a/>",{href:a.link,target:"_blank",text:a.message.substr(0,50)+"..."});b.children(".title").html(e);d=$('<a href="#"><span></span></a>').attr("class",a.network);b.children(".network").html(d);b.children(".reply").attr({href:a.link,target:"_blank"});return b},processData:function(){var a=this.data.messages,b=this.getContentDom().find(".data-grid-holder"),c=b.find(".row:first");b.find(".row").remove();for(var d in a){var e=a[d];if(e instanceof Array){for(var f in e){b.append(this.processRow(e[f],c.clone(),d))}}else b.append(this.processRow(e,c.clone(),d))}},construct:function(){this.noApiUrl=true}});var BC_GraphBoxController=BoxController.extend({graphData:null,getGraphHolder:function(){if(!this._graphHolder){this._graphHolder=$("#"+this.boxId+"-graph-holder")}return this._graphHolder},init:function(){this.getContentDom().children().hide();this.getContentDom().parent().find(".box-header-button-show-graph").click(this.showGraph);this.getContentDom().parent().find(".box-header-button-show-data").click(this.showData);if(this.getContentDom().length){this.refresh()}},computeDateInterval:function(){var a=this.range["period"],b;switch(a){case"1m":b=Math.floor(getPeriodInDays(this.range["period"])/6)+1;break;case"3m":b=Math.floor(getPeriodInDays(this.range["period"])/6)+3.2;break;case"6m":b=Math.floor(getPeriodInDays(this.range["period"])/6)+6.2;break;case"1y":b=Math.floor(getPeriodInDays(this.range["period"])/6)+13;break;case"all":var c=new Date;var d=new Date;d.setFullYear(1970,0,1);var e=(c.getTime()-d.getTime())/(1e3*3600*24);b=Math.floor(e/6)+e/30;break;case"ytd":var c=new Date;var d=new Date;d.setMonth(0,1);var e=(c.getTime()-d.getTime())/(1e3*3600*24);b=Math.floor(e/6)+e/31;break;default:var c=new Date(this.range["date"]);var d=new Date(this.range["period"]);var e=(d.getTime()-c.getTime())/(1e3*3600*24);b=Math.floor(e/6)+e/31;break}return b},beforeLoadData:function(){this.showLoader();this.getHeaderDom().find(".box-header-right-buttons a").removeClass("active");this.data=null;if(this.graph){this.graph.destroy();this.graph=null;this.graphData=null}},showData:function(){var a=null;if(this instanceof BoxController){a=this.getBoxDom()}else{a=$(this).parents(".box:first")}var b=a.find(".box-content");b.children().hide();a.find(".box-header-button").removeClass("active");var c=a.find(".data-grid-holder");if(!c.is(":visible")){c.show()}a.find(".box-header-button-show-data").addClass("active");return false},showGraph:function(){var a=null;if(this instanceof BoxController){a=this.getBoxDom()}else{a=$(this).parents(".box:first")}var b=a.find(".box-content");b.children().hide();var c=b.find(".graph-holder");var d=boxManager.getBox(a.attr("id"));a.find(".graph-holder").show();d.getHeaderDom().find(".box-header-right-buttons a").removeClass("active").filter(".box-header-button-show-graph").addClass("active");if(!d.graphData){d.loadGraphData()}else if(c.children().length){c.children().show()}else{d.prepareGraph()}return false},beforeLoadGraphData:function(){this.getHeaderDom().find(".box-header-right-buttons a").removeClass("active");if(this.graph){this.graph.destroy();this.graph=null}this.graphData=null;this.getGraphHolder().append(this.getLoaderHtml())},processData:function(){this.graphData=this.data;this.afterLoadGraphData()},loadGraphData:function(){this.beforeLoadGraphData();this.graphData=null;this.graphData=this.dataProvider.setEndpoint(this.endpoint).setDateRange(this.range).setFilters(this.filters).setDateInterval(6).setCallback(this.loadDataCallback(this)).fetch();return this},afterLoadGraphData:function(){this.getGraphHolder().children().remove();this.getHeaderDom().find(".box-header-right-buttons a.box-header-button-show-graph").addClass("active");for(var a in this.graphData);if(!this.graphData[a]){this.getContentDom().find(".graph-holder").html('<p style="margin:5%;">Nothing heard through the Grapevine \n\nfor the date range you selected. Expand your date range to see more data.</p>').show()}else this.showGraph();return this},prepareGraph:function(){alert("'prepareGraph' is not implemented!!!")},clearData:function(){this.data=null;this.graphData=null}});var BC_LinearGraphBoxController=BC_GraphBoxController.extend({series:[],seriesLabels:[],firstTimestamp:null,dayInterval:3600*24,maxValue:null,formatterCallback:null,getFirstDate:function(){if(this.firstTimestamp)return this.firstTimestamp;for(var a in this.graphData);for(var b in this.graphData[a]){var c=parseInt(b,10);break}c=new Date(c*1e3);return this.firstTimestamp=Date.parse(new Date(c.getFullYear(),c.getMonth(),c.getDate()))},populateGraph:function(){alert("Must be implemented in extending class")},reset:function(){this.firstTimestamp=null;this.series=[];this.seriesLabels=[]},prepareGraph:function(){if(!this.graphData){return}this.reset();this.populateGraph();var a=this.boxId+"-graph-holder";var b={chart:{renderTo:a,type:"spline"},title:{text:false},credits:{enabled:false},colors:["#80699B","#AA4643","#4572A7","#89A54E","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"],xAxis:{startOfWeek:0,type:"datetime",labels:{formatter:this.formatterCallback}},yAxis:{title:{text:false,align:"high"},min:0,max:6,endOnTick:false},exporting:{enabled:false},series:this.series,plotOptions:{series:{events:{legendItemClick:function(a){return false}}}}};this.graph=new Highcharts.Chart(b)},construct:function(){}});var BC_Inbox=BoxController.extend({currentPage:1,totalPages:null,limit:10,ignore:false,extraParams:null,getPagerHolder:function(){if(!this._pagerDom){this._pagerDom=$("#"+this.boxId+" .box-pager")}return this._pagerDom},beforeLoadData:function(){this.getContentDom().children().hide();this.getContentDom().append(this.getLoaderHtml());this.getFiltersDom().find(".box-filter").html(this.getLoaderHtml())},attachBoxEvents:function(){var a=this;a.getBoxDom().delegate("a[data-filter-status]","click",function(b){b.preventDefault();var c=$(this).attr("data-filter-status");var d=$(this).parent().attr("class");d=d.replace("box-filter box-filter-","");if($(this).hasClass("show-all")){a.resetFilters(d)}else{a.addFilter(d,c)}a.currentPage=1;a.refresh()});a.getPagerHolder().delegate(".prev, .next","click",function(b){b.preventDefault();var c=false;if($(this).hasClass("next")){if(a.currentPage<a.totalPages){a.currentPage++;c=true}}if($(this).hasClass("prev")){if(a.currentPage>1){a.currentPage--;c=true}}if(c)a.loadData()});a.getBoxDom().delegate("tr.collapsed","hover",function(a){$(this).find(".expand").toggleClass("show")});a.getBoxDom().delegate(".close-button, .save-button","click",function(a){a.preventDefault();$(this).parents("tr.expanded").addClass("hidden-row").prev().removeClass("border")});a.getBoxDom().delegate("table tr[data-row-id].collapsed","click",function(a){a.preventDefault();var b=$(this).next();if(!$(this).hasClass("border")){b.trigger("expand")}else{b.addClass("hidden-row")}$(this).toggleClass("border")})},loadFilters:function(a){var b=this.data.filters[a];var c=0;var d=this.getFiltersDom().find(".box-filter-"+a);d.html("");for(var e in b){var f=$('<a href="#" data-filter-status="'+b[e].value+'"></a>');if(b[e].total){f.text(b[e].total+" ")}if(b[e].active==1){f.addClass("active");c++}if(e=="Total"||e=="All"){f.addClass("show-all")}f.text(f.text()+e);d.append('<span class="separator">|</span> ');d.append(f)}if(c>1){d.find(".show-all").removeClass("active")}},loadInboxData:function(){alert("You must implement it by yourself")},initFilters:function(){var a=this.data.filters;if(a){for(var b in a){this.loadFilters(b)}}},afterLoadDataCustom:function(){this.initFilters()},processData:function(){this.loadInboxData();this.initFilters();this.initPager()},loadData:function(){this.initEmailExport();this.beforeLoadData();this.dataProvider.setEndpoint(this.endpoint).setDateRange(this.range).setFilters(this.filters).setDateInterval(null).setPage(this.currentPage).setExtraParams(this.extraParams).setLimit(this.limit).setCallback(this.loadDataCallback(this));this.data=this.dataProvider.fetch();return this},initEmailExport:function(){var a=$("#email-export .from"),b=$("#email-export .reply"),c=$([]).add(a,b);$("#email-export").dialog({autoOpen:false,height:300,width:350,modal:true,buttons:{Send:function(){var d=true;c.removeClass("ui-state-error");d=d&&helpers.checkLength(b,"Send to",6,80);d=d&&helpers.checkLength(a,"From Email",6,80);var e=b.val().split(",");d=d&&helpers.checkRegexp(a,a.val(),/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com");for(var f in e){d=d&&helpers.checkRegexp(b,e[f],/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com")}var g=$(this);if(d){a.attr("disabled","disabled");b.attr("disabled","disabled");helpers.tips.html("Email is sending to recipients, please wait...");$.post("/api/box/email/post",{from:a.val(),to:e,data:g.data("post")},function(){a.removeAttr("disabled");b.removeAttr("disabled");helpers.tips.html("<strong>Email was sent correctly . This message will close in 2 seconds.</strong>");setTimeout(function(){c.attr("value","");helpers.tips.html("Please provide email addresses you would like to send this report to‭ (‬use commas to send to multiple‭).");g.dialog("close")},3e3)})}},Cancel:function(){$(this).dialog("close")}},close:function(){c.val("").removeClass("ui-state-error")}})},initPager:function(){var a=this.data.pagination;this.currentPage=a.page;this.totalPages=a.pagesCount;this.pagerInited=true;if(this.getPagerHolder()){this.getPagerHolder().find(".page").text(a.page);this.getPagerHolder().find(".pageCount").text(a.pagesCount)}return this},expandEndpointCallback:function(a,b){a.preventDefault();var c={};var d=$(a.target).val();c[b.name]=b.split?d.split(","):d;var e=b.endpoint+"/"+b.id;boxManager.genericRequest(e,c)},populateFields:function(a,b){var c=$(b.trContext);b.context.customPopulateFields(a,b);c.find(".action-email").bind("click",function(b){b.preventDefault();if(a.review)$("#email-export").data("post",a.review);else $("#email-export").data("post",a.social);$("#email-export").dialog("open")});b.trContext.prev().find(".expand-preloader").removeClass("expand-preloader").addClass("expand");c.removeClass("hidden-row")},expandedPopulate:function(a,b){$(a.target).find("*").unbind();b.trContext=$(a.target);b.trContext.prev().find(".expand").removeClass("expand").addClass("expand-preloader");b.context.expandedPopulateCallback(b)},expandedPopulateCallback:function(a){alert("not implemented")},construct:function(){}});var BC_CompetitionScore=BoxController.extend({boxId:"box-competition-score",endpoint:"/api/dataProvider/competition/ogsi",populateColumns:function(a,b,c){var d;for(var e in a){d=b.clone();d.text(e);c.append(d)}},addColumn:function(a,b,c,d){var e=b.clone();var f=b.clone();var g=b.clone();e.find(".score").text(parseFloat(a.ogsi.value).toFixed(2)+"%");e.find(".rank").text(a.ogsi.rank.value+" of "+a.ogsi.rank.out);f.find(".score").text(parseFloat(a.rating.value).toFixed(2));f.find(".rank").text(a.rating.rank.value+" of "+a.rating.rank.out);g.find(".score").text(a.reviews.value.toFixed(2));g.find(".rank").text(a.reviews.rank.value+" of "+a.reviews.rank.out);var h=[e,f,g];var i=0;c.find("tr").each(function(){$(this).append("<td "+(d?'class="even"':"")+">"+h[i++].html()+"</td>")})},filterRowsCallback:function(a){return this.genericCallbackEventWrapper(function(a,b){a.preventDefault();var c=$(a.target).attr("filter");b.table.find("tr."+c).toggleClass("hide");$(a.target).toggleClass("active")},{table:a})},processData:function(){var a=this.getContentDom().find(".data-grid-holder");var b;if(!this.cachedTable){b=a.find("table");this.getBoxDom().delegate("a[filter]","click",this.filterRowsCallback(b));this.cachedTable=b.clone()}else if(this.cachedTable){a.find("table").remove();b=this.cachedTable.clone();a.append(b);this.getBoxDom().undelegate("a").delegate("a[filter]","click",this.filterRowsCallback(b)).find("a[filter]").removeClass("active").addClass("active")}var c=b.find("thead tr"),d=b.find("tbody"),e=c.find("th"),f=this.data.ogsi,g=b.find("tbody tr th:nth-child(2)"),h=g.clone(),i=0;g.remove();this.populateColumns(f,e,c);for(var j in f){this.addColumn(f[j],h,d,i++%2)}},construct:function(){this.noApiUrl=true}});var BC_Scoreboard=BoxController.extend({boxId:"box-ogsi",endpoint:"/api/dataProvider/scoreboard/overall",processData:function(){var a=this.getContentDom(),b=this.data.overall;if(b){a.find(".ogsi-score-value").text(b.ogsi);a.find(".ogsi-rating-value").text(b.rating.score);a.find(".ogsi-rating-stars-on").css("width",b.rating.score/5*100+5+"%");a.find(".ogsi-reviews-value").text(b.reviews);a.show();var c=b.rating;var d=a.find(".bar-holder");var e=Math.max(c.negative,c.positive,c.neutral);var f=c.negative+c.positive+c.neutral;var g;if(f){d.show();var h=d.find(".bar-negative");h.children(".bar-value").text("");if(c.negative>0){g=c.negative/e*100;if(g>5)h.children(".bar-value").text(c.negative)}h=d.find(".bar-neutral");h.children(".bar-value").text("");if(c.neutral>0){g=c.neutral/e*100;if(g>5)h.children(".bar-value").text(c.neutral);h.css("width",(c.neutral+c.positive)/f*100+"%");h.show()}else if(c.positive>0){h.css("width",c.positive/f*100+"%");h.show()}else{h.hide()}h=d.find(".bar-positive");h.children(".bar-value").text("");if(c.positive>0){g=c.positive/e*100;if(g>5)h.children(".bar-value").text(c.positive);h.css("width",c.positive/(c.neutral+c.positive)*100+"%");h.show()}else{h.hide()}}else{d.hide()}}},construct:function(){this.noApiUrl=true}});var BC_StatusUpdate=BoxController.extend({boxId:"box-status-updates",endpoint:"/api/box/auth",attachBoxEvents:function(){var a=this;this.getContentDom().find(".status-updater textarea").charCount({allowed:120,warning:20,submitEnable:this.getContentDom().find(".buttons button")});this.getContentDom().delegate("form#wallPoster","submit",function(b){b.preventDefault();var c=$(b.target).children("textarea.content").attr("disabled","disabled");var d={};d.message=c.val();$($(this).serializeArray()).each(function(){d[this.name]=true});$.post("/api/box/update",d,function(a){}).error(function(){}).complete(function(){c.removeAttr("disabled");c.val("");a.getContentDom().find(".message span").fadeIn();setTimeout(function(){a.getContentDom().find(".message span").fadeOut()},3e3)})})},processData:function(){if(!this.data.facebook_page_name&&!this.data.twitter_account){this.getContentDom().find(".status-updater").html('<p class="message">You need to activate Your facebook or twitter account in Account Settings</p>')}if(this.data.facebook_page_name){this.getContentDom().find(".page_name").text(this.data.facebook_page_name)}else this.getContentDom().find(".facebook_checkbox").remove();if(this.data.twitter_account){this.getContentDom().find(".twitter_account").text(this.data.twitter_account)}else this.getContentDom().find(".twitter_checkbox").remove()},construct:function(){this.noApiUrl=true}});var BC_Photos=BoxController.extend({boxId:"box-photos",endpoint:"photos",processData:function(){},construct:function(){}});var BC_Videos=BoxController.extend({boxId:"box-videos",endpoint:"videos",processData:function(){},construct:function(){}});var BC_ScoreboardCurrent=BoxController.extend({boxId:"box-ogsi-current",endpoint:"/api/dataProvider/scoreboard/current",processData:function(){var a=this.getContentDom(),b=this.data.current,c=b.rating,d=a.find(".bar-holder"),e;if(b){var f=Math.max(c.negative,c.positive,c.negative),g=c.negative+c.positive+c.neutral;var h=getPeriodInDays(this.range["period"]);var i;if(!h&&this.range["period"]=="ytd"){var j=new Date;var k=new Date;k.setMonth(0,1);i=Math.ceil((j.getTime()-k.getTime())/(1e3*3600*24))}else if(h){i=h}else{if(this.range["period"]=="all")i="All";else{var l=Date.parse(this.range["date"]);var m=Date.parse(this.range["period"]);var n=Math.ceil((m-l)/(1e3*3600*24));i=n}}a.find(".days").text(i);a.find(".ogsi-score-value").text(b.ogsi);a.find(".ogsi-rating-value").text(b.rating.score);a.find(".ogsi-rating-stars-on").css("width",b.rating.score/5*100+5+"%");a.find(".ogsi-reviews-value").text(b.reviews);a.show();if(g){d.show();var o=d.find(".bar-negative");o.children(".bar-value").text("");if(c.negative>0){e=c.negative/f*100;if(e>5)o.children(".bar-value").text(c.negative)}o=d.find(".bar-neutral");o.children(".bar-value").text("");if(c.neutral>0){e=c.neutral/f*100;if(e>5)o.children(".bar-value").text(c.neutral);o.css("width",(c.neutral+c.positive)/g*100+"%");o.show()}else if(c.positive>0){o.css("width",c.positive/g*100+"%");o.show()}else{o.hide()}o=d.find(".bar-positive");o.children(".bar-value").text("");if(c.positive>0){e=c.positive/f*100;if(e>5)o.children(".bar-value").text(c.positive);o.css("width",c.positive/(c.neutral+c.positive)*100+"%");o.show()}else{o.hide()}}else{d.hide()}}},construct:function(){this.noApiUrl=true}});var BC_TagsAnalysis=BC_GraphBoxController.extend({boxId:"box-tags-analysis",endpoint:"/api/dataProvider/reviews/category_breakdown",prepareGraph:function(){if(!this.graphData){return}var a=this.getGraphHolder();var b=a.attr("id");var c={chart:{renderTo:b,margin:[0,0,30,0],defaultSeriesType:"pie"},plotOptions:{pie:{dataLabels:{enabled:false},showInLegend:true},series:{legendItemClick:function(a){a.preventDefault();return false},point:{events:{legendItemClick:function(a){a.preventDefault();return false}}}}},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>: "+this.y+" %"}},title:"",exporting:{enabled:false},credits:{enabled:false},legend:{borderRadius:0},series:[]};var d={type:"pie",name:"Categories",data:[]};for(var e=0;e<this.graphData.length;e++){d.data.push([this.graphData[e].category,parseFloat(this.graphData[e].percent)])}c.series.push(d);this.graph=new Highcharts.Chart(c)},processData:function(){var a=this.data.categories;this.graphData=a;var b=this.getContentDom().find(".data-grid-holder > table");var c=b.find("tbody tr:first").clone();var d=null;b.find("tbody tr").remove();for(var e=0;e<a.length;e++){d=c.clone();for(n in a[e]){var f=a[e][n];if(n=="percent"){f=f+"%"}d.find("td.col-"+n).text(f)}b.find("tbody").append(d)}},construct:function(){this.noApiUrl=true}});var BC_ReviewSites=BC_GraphBoxController.extend({boxId:"box-review-sites",endpoint:"/api/dataProvider/reviews/sites",prepareGraph:function(){var a=this.boxId+"-graph-holder";if(!this.graphData){this.showNoData(".graph-holder");return}var b={chart:{renderTo:a,defaultSeriesType:"bar"},title:{text:""},colors:["#80699B","#AA4643","#4572A7","#89A54E","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"],xAxis:{categories:[],title:{text:""}},yAxis:{min:0,title:{text:"",align:"high"}},plotOptions:{series:{stacking:"normal",events:{legendItemClick:function(a){a.preventDefault();return false}}}},legend:{verticalAlign:"bottom",borderWidth:1,borderRadius:0,backgroundColor:"#FFFFFF",shadow:true},credits:{enabled:false},exporting:{enabled:false},series:[{name:"Negative",data:[],color:"#be1622",shadow:false},{name:"Neutral",data:[],color:"rgb(243,190,0)",shadow:false},{name:"Positive",data:[],color:"#218D48",shadow:false}]};for(var c in this.graphData){var d=this.graphData[c];b.xAxis.categories.push(d.site);b.series[0].data.push(d.negative);b.series[1].data.push(d.neutral);b.series[2].data.push(d.positive)}this.graph=new Highcharts.Chart(b)},processData:function(){var a=this.data.sites,b=this.getContentDom().find(".data-grid-holder > table"),c=b.find("tbody tr:first").clone(),d=null,e=b.find("tfoot tr");this.graphData=a;e.find("th:not(:first)").text("0");b.find("tbody tr").remove();var f=0;for(var g in a){d=c.clone();for(n in a[g]){var h=a[g][n];d.find("td.col-"+n).text(h);if(n!="site"){var i=0;if(n=="average"){i=parseFloat(e.find("th.col-"+n).text());h=parseFloat(h)}else{i=parseInt(e.find("th.col-"+n).text())}e.find("th.col-"+n).text(h+i)}}b.find("tbody").append(d);f++}var j=parseFloat(e.find("th.col-average").text())/f;j=j.toFixed(1);e.find("th.col-average").text(j)},construct:function(){this.noApiUrl=true}});var BC_ReviewInbox=BC_Inbox.extend({boxId:"box-recent-reviews",endpoint:"/api/dataProvider/reviews",alerts:{},dateHelper:function(a){var b=new Date(a*1e3);return monthNames[b.getMonth()]+" "+b.getDate()},titleLink:$('<a href="#" class="title"></a>'),expandButton:$('<a href="#" class="expand"></a>'),prepareMessage:function(a,b){a=a.clone();a.addClass("collapsed").attr("data-row-id",b.id);for(var c in b){var d=b[c],e=a.find("td.col-"+c),f;switch(c){case"date":e.text(this.dateHelper(d));break;case"title":f=this.titleLink.clone();f.text(d);e.find("div.in").html(f).prepend(this.expandButton.clone());break;case"score":e.html($('<div class="reviewRating"><div class="stars-'+d+'-of-5-front"><span>'+d+" stars</span></div></div>"));break;case"status":d=d.toLowerCase();var g=d=="opened"?" ":d=="closed"?" x ":"!";e.html($('<div class="reviewStatus reviewStatus-'+d+'"><span>[ '+g+" ]</span></div>"));break;default:e.text(d);break}}return a},customPopulateFields:function(a,b){var c=a.review,d=$(b.trContext),e=d.find(".single-check > input:checkbox"),f=c.status.toLowerCase(),g=d;d.find(".recent-review-status-icon").removeClass("open closed todo").addClass(f);d.find(".review-details-title").text(c.title);d.find(".review-details-content").text(c.content);if(c.identity){d.find(".author").text(c.identity)}if(c.link)d.find(".action-review").attr("href",c.link);else{d.find(".actions-review").remove();var h=Site.check(c.site);if(h)d.find(".actions-reply").attr("href",h);else{d.find(".recentReviewDetailsButtons").prepend('<span class="man-disabled">Management Responses Not Available for this Review Site</span>');d.find(".actions-reply").remove()}}e.prop("checked",false);e.each(function(){if($(this).val()==f)$(this).prop("checked",true)});e.bind("change",function(){var a=$(this).is(":checked");var g=e.filter(":checked").length;var h=$(this).val();e.attr("disabled","disabled");if(a){e.prop("checked",false);$(this).prop("checked",true);boxManager.genericRequest("/api/dataProvider/reviews"+"/status/"+b.id,{status:h.toUpperCase()},function(){b.context.renderAlerts();d.find(".recent-review-status-icon").removeClass("open closed todo").addClass(h);var a=h=="opened"?" ":h=="closed"?" x ":"!";var c=$('<div class="reviewStatus reviewStatus-'+h+'"><span>[ '+a+" ]</span></div>");d.prev().find(".col-status").html(c);e.removeAttr("disabled")})}else if(!g&&c.score>=3){boxManager.genericRequest("/api/dataProvider/reviews"+"/status/"+b.id,{status:"OPENED"},function(){d.find(".recent-review-status-icon").removeClass("open closed todo").addClass("opened");f="opened";var a=$('<div class="reviewStatus reviewStatus-opened"><span>[  ]</span></div>');d.prev().find(".col-status").html(a);e.removeAttr("disabled")})}});d.find('select[name="category"]').val(c.category).bind("change",b.context.genericCallbackEventWrapper(b.context.expandEndpointCallback,{id:b.id,endpoint:"/api/dataProvider/reviews/category",name:"category",context:b.context}));d.find("input.review-tags").val(c.tags?c.tags.join(","):"").bind("save",b.context.genericCallbackEventWrapper(b.context.expandEndpointCallback,{id:b.id,endpoint:"/api/dataProvider/reviews/tags",name:"tags",context:b.context,split:true}));d.find('textarea[name="notes"]').val(c.notes).bind("save",b.context.genericCallbackEventWrapper(b.context.expandEndpointCallback,{id:b.id,endpoint:"/api/dataProvider/reviews/notes",name:"notes",context:b.context}));d.find(".save-button").bind("click",function(a){$.each(["tags","notes"],function(){g.find("*[name="+this+"]").trigger("save")})})},expandedPopulateCallback:function(a){boxManager.genericRequest("/api/dataProvider/reviews"+"/categories",{},function(b){var c=a.trContext.find(".review-categories").html("");var d=$("<option />");$.each(b.categories,function(a,b){c.append(d.clone().val(a).text(b))});a.customPopulateFields=this.reviewPopulate;boxManager.genericRequest("/api/dataProvider/reviews"+"/expand/"+a.id,{},a.context.genericCallbackEventWrapper(a.context.populateFields,a))})},loadInboxData:function(){var a=this.getContentDom().find(".data-grid-holder table.data-grid");var b=a.find("tbody tr:first").clone().removeClass("odd even border");var c=a.find("tbody:first > tr:last").clone();var d=null;var e=null;a.find("tbody tr").remove();var f=this.data.reviews;for(var g=0;g<f.length;g++){var h=f[g].id,i=f[g].status,j=i.toLowerCase();d=this.prepareMessage(b,f[g]);e=c.clone().attr("data-row-id",h).bind("expand",this.genericCallbackEventWrapper(this.expandedPopulate,{context:this,id:h}));if(g%2){d.addClass("odd")}else{d.addClass("even")}var k=$('<input type="checkbox" name="id[]" value=""  />');k.attr("value",h);d.find("td.col-checkbox").html(k);a.children("tbody").append(d);a.children("tbody").append(e)}this.getContentDom().find(".ajax-loader").remove();this.getContentDom().find(".data-grid-holder").show()},renderAlerts:function(){var a=$("#alerts .light-box-content");if(!a.length)return;var b=this;$.post("/api/dataProvider/reviews/alerts",{status:"alert"},function(c){b.alerts["alert"]=c.alerts;$.post("/api/dataProvider/reviews/alerts",{status:"todo"},function(c){b.alerts["todo"]=c.alerts;if(b.alerts["alert"]!==null){for(var d in b.alerts){a.find(".desc ."+d).text(b.alerts[d])}a.parent().removeClass("hide")}})})},initBoxEvents:function(){this.renderAlerts();$("#alerts a.alert-show, #alerts a.todo-show").bind("click",function(a){a.preventDefault();var b="width=800,height=570,menubar=no,location=no,resizable=no,scrollbars=yes,status=no";window.open(this.href,"alerts",b)})},construct:function(){this.noApiUrl=true;if(this.filter=this.getBoxDom().attr("filter")){var a=new Date;this.addFilter("status",this.filter);this.setRange({period:this.getBoxDom().attr("period"),date:this.getBoxDom().attr("date")});this.extraParams={include_date:false};$(".window-close").bind("click",function(){window.close()})}this.initBoxEvents()}});var BC_SocialActivity=BC_GraphBoxController.extend({boxId:"box-social-activity",endpoint:"/api/dataProvider/socials/activity",prepareGraph:function(){if(!this.graphData){return}var a=this.boxId+"-graph-holder",b=[],c=this,d=function(a,b,d,e){c.graph.xAxis[0].setCategories(b);c.graph.series[0].remove();c.graph.addSeries({name:a,data:d,color:e||"white"})},e=[],f=Highcharts.getOptions().colors,g=0;for(var h in this.graphData){e.push(this.graphData[h].network);var i=[],j=[];for(var k in this.graphData[h].categories){i.push(k);j.push(this.graphData[h].categories[k])}b.push({y:this.graphData[h].total,color:f[g],drilldown:{name:this.graphData[h].network,categories:i,data:j,color:f[g++]}})}var l={chart:{renderTo:a,type:"bar"},title:{text:false},xAxis:{categories:e,title:{text:""}},yAxis:{min:0,title:{text:false}},legend:{enabled:false},credits:{enabled:false},plotOptions:{bar:{cursor:"pointer",point:{events:{click:function(){var a=this.drilldown;if(a){d(a.name,a.categories,a.data,a.color)}else{d(false,e,b)}}}},dataLabels:{enabled:true,style:{fontWeight:"bold"},formatter:function(){return this.y}}}},tooltip:{formatter:function(){var a=this.point,b=this.x+":<b>"+this.y+" actions</b><br/>";if(a.drilldown){b+="Click to view details"}else{b+="Click to return to overall graph"}return b}},series:[{data:b}],exporting:{enabled:false}};this.graph=new Highcharts.Chart(l)},processData:function(){var a=this.data.networks,b=this.getContentDom().find(".data-grid-holder > table"),c=b.find("tbody tr:first").clone(),d=null;this.graphData=a;trFooter=b.find("tfoot tr");trFooter.find("th.col-total").text("0");b.find("tbody tr").remove();for(var e=0;e<a.length;e++){d=c.clone();for(n in a[e]){var f=a[e][n];d.find("td.col-"+n).text(f);if(n!="network"){var g=0;if(n=="average"){g=parseFloat(trFooter.find("th.col-"+n).text())}else{g=parseInt(trFooter.find("th.col-"+n).text())}trFooter.find("th.col-"+n).text(parseInt(f)+g)}}if(e%2){d.addClass("even")}else{d.addClass("odd")}b.find("tbody").append(d)}},construct:function(){this.noApiUrl=true}});var BC_SocialSubscribers=BC_GraphBoxController.extend({boxId:"box-social-reach",endpoint:"/api/dataProvider/socials/subscribers",prepareGraph:function(){if(!this.graphData){return}var a=this.boxId+"-graph-holder",b=[],c=this,d=function(a,b,d,e){c.graph.xAxis[0].setCategories(b);c.graph.series[0].remove();c.graph.addSeries({name:a,data:d,color:e||"white"})},e=[],f=Highcharts.getOptions().colors,g=0;for(var h in this.graphData){e.push(this.graphData[h].network);var i=[],j=[];for(var k in this.graphData[h].categories){i.push(k);j.push(this.graphData[h].categories[k])}b.push({y:this.graphData[h].total,color:f[g],drilldown:{name:this.graphData[h].network,categories:i,data:j,color:f[g++]}})}var l={chart:{renderTo:a,type:"bar"},title:{text:false},xAxis:{categories:e,title:{text:""}},yAxis:{min:0,title:{text:false}},legend:{enabled:false},credits:{enabled:false},plotOptions:{bar:{cursor:"pointer",point:{events:{click:function(){var a=this.drilldown;if(a){d(a.name,a.categories,a.data,a.color)}else{d(false,e,b)}}}},dataLabels:{enabled:true,style:{fontWeight:"bold"},formatter:function(){return this.y}}}},tooltip:{formatter:function(){var a=this.point,b=this.x+":<b>"+this.y+" actions</b><br/>";if(a.drilldown){b+="Click to view details"}else{b+="Click to return to overall graph"}return b}},series:[{data:b}],exporting:{enabled:false}};this.graph=new Highcharts.Chart(l)},processData:function(){var a=this.getContentDom().find(".data-grid-holder > table"),b=this.data.networks,c=a.find("tbody tr:first").clone(),d=null,e=a.find("tfoot tr");this.graphData=b;e.find(".col-value, .col-total").text("0");a.find("tbody tr").remove();for(var f=0;f<b.length;f++){d=c.clone();for(n in b[f]){var g=b[f][n];if(n=="change"){g=g+"%"}else if(n=="value"||n=="total"){var h=0;h=parseFloat(e.find("th.col-"+n).text());e.find("th.col-"+n).text(g+h)}d.find("td.col-"+n).text(g)}if(f%2){d.addClass("even")}else{d.addClass("odd")}a.find("tbody").append(d)}},construct:function(){this.noApiUrl=true}});var BC_CompetitionReviewInbox=BC_Inbox.extend({boxId:"box-competition-review-inbox",endpoint:"/api/dataProvider/competition",prepareMessage:function(a,b){a=a.clone();var c=parseInt(b.id);a.addClass("collapsed").attr("data-row-id",c);for(key in b){var d=b[key];var e=a.find("td.col-"+key);var f;switch(key){case"date":var g=new Date(d*1e3);var h=monthNames[g.getMonth()]+" "+g.getDate();e.text(h);break;case"title":f=$('<a href="#" class="title"></a>');f.text(d);e=e.find("div.in");e.html(f);e.prepend('<a href="#" class="expand"></a>');break;case"score":var i=$('<div class="reviewRating"><div class="stars-'+d+'-of-5-front"><span>'+d+" stars</span></div></div>");e.html(i);break;default:e.text(d);break}}return a},customPopulateFields:function(a,b){var c=a.review;var d=$(b.trContext);d.find(".details-title").text(c.title);d.find(".details-content").text(c.content);if(c.link!==undefined)d.find(".goto-link").attr("href",c.link);else d.find(".goto").remove();if(c.identity){d.find(".author").text(c.identity)}d.find(".actions-network").remove()},expandedPopulateCallback:function(a){boxManager.genericRequest("/api/dataProvider/competition"+"/expand/"+a.id,{},a.context.genericCallbackEventWrapper(a.context.populateFields,a))},loadInboxData:function(){var a=this.getContentDom().find(".data-grid-holder table.data-grid");var b=a.find("tbody tr:first").clone().removeClass("odd even border");var c=a.find("tbody:first > tr:last").clone();var d=null;var e=null;a.find("tbody tr").remove();var f=this.data.reviews;for(var g=0;g<f.length;g++){var h=f[g].id;e=c.clone().attr("data-row-id",h).bind("expand",this.genericCallbackEventWrapper(this.expandedPopulate,{context:this,id:h}));d=this.prepareMessage(b,f[g]);if(g%2){d.addClass("even")}else{d.addClass("odd")}var i=$('<input type="checkbox" name="id[]" value=""  />');i.attr("value",f[g].id);d.find("td.col-checkbox").html(i);a.find("tbody").append(d,e)}this.getContentDom().find(".ajax-loader").remove();this.getContentDom().find(".data-grid-holder").show()},construct:function(){this.noApiUrl=true}});var BC_CompetitionComparision=BC_LinearGraphBoxController.extend({boxId:"box-competition-comparision",series:[],endpoint:"/api/dataProvider/competition/comparsion",seriesLabels:[],firstTimestamp:null,pointInterval:null,scaleFactor:null,dayInterval:3600*24,formatterCallback:function(){var a;var b=boxManager.getBox("box-competition-comparision");switch(b.range["period"]){case"1m":a="%a %e";break;case"3m":a="%d %b";break;case"6m":a="%d %b";break;case"1y":a="%b %Y";break;default:a="%a %e";break}return Highcharts.dateFormat(a,this.value)},populateGraph:function(){var a=[];var b=false;this.series=[];var c;for(var d in this.graphData.comparision){var e=this.graphData.comparision[d];for(var f in e){var g=e[f];if(!b){a[g.competition]=this.series.length;this.series.push({name:g.competition,data:[],pointStart:this.getFirstDate(),pointInterval:this.computeDateInterval()*this.dayInterval*1e3})}c=parseFloat(g.value);this.maxValue=this.maxValue<c?c:this.maxValue;this.series[a[g.competition]].data.unshift(c)}if(!b){b=true}}},loadData:function(){this.loadGraphData()},construct:function(){this.noApiUrl=true}});var BC_CompetitionDistribution=BC_GraphBoxController.extend({boxId:"box-competition-distribution",endpoint:"/api/dataProvider/competition/distribution",prepareGraph:function(){if(!this.data){return}var a=this.boxId+"-graph-holder";var b=$("#"+a);var c={chart:{renderTo:a,type:"bar"},title:"",xAxis:{categories:[],title:{text:""}},yAxis:{min:0,title:{text:""}},plotOptions:{series:{stacking:"normal"}},legend:{verticalAlign:"bottom",borderWidth:1,borderRadius:0,backgroundColor:"#FFFFFF",shadow:true},credits:{enabled:false},exporting:{enabled:false},series:[{name:"Negative",data:[],color:"#be1622",shadow:false},{name:"Neutral",data:[],color:"rgb(243,190,0)",shadow:false},{name:"Positive",data:[],color:"#218D48",shadow:false}],plotOptions:{series:{events:{legendItemClick:function(a){return false}}}}};for(var d in this.graphData){var e=this.graphData[d];c.xAxis.categories.push(d);c.series[0].data.push(e.negative);c.series[1].data.push(e.neutral);c.series[2].data.push(e.positive)}this.graph=new Highcharts.Chart(c)},processData:function(){var a=0,b=this.data.distribution,c=this.getContentDom().find(".data-grid-holder > table"),d=c.find("tbody tr:first").clone(),e=null,f=c.find("tfoot tr");this.graphData=b;f.find("th:not(:first)").text("0");c.find("tbody tr").remove();for(var g in b){e=d.clone();for(n in b[g]){var h=b[g][n];e.find("td.col-"+n).text(h);var i=0;if(n=="average"){i=parseFloat(f.find("th.col-"+n).text())}else{i=parseInt(f.find("th.col-"+n).text())}f.find("th.col-"+n).text(parseFloat(h)+i);e.find("td.col-dealership").text(g)}c.find("tbody").append(e);a++}var j=parseFloat(f.find("th.col-average").text())/a;j=j.toFixed(2);f.find("th.col-average").text(j)},construct:function(){this.noApiUrl=true}});var BC_SocialMediaInbox=BC_Inbox.extend({boxId:"box-social-media-inbox",endpoint:"/api/dataProvider/socials",prepareMessage:function(a,b){a=a.clone();a.addClass("collapsed").attr("data-row-id",b.id);for(key in b){var c=b[key];var d=a.find("td.col-"+key);var e;switch(key){case"date":var f=new Date(c*1e3);var g=monthNames[f.getMonth()]+" "+f.getDate();d.text(g);break;case"title":e=$('<a href="#" class="title"></a>');e.text(c);d=d.find("div.in");d.html(e);d.prepend('<a href="#" class="expand"></a>');break;case"network":e=$('<a href="#"><span>'+c.toLowerCase()+"</span></a>");e.attr("class",c.toLowerCase());e.filter("span").text(c);d.html(e);break;default:d.text(c);break}}return a},customPopulateFields:function(a,b){var c=a.social;var d=$(b.trContext);var e;if(c.link){e=$("<a/>",{href:c.link,text:c.title})}else{e=c.title}d.find(".details-title").html(e);d.find(".details-content").text(c.content);d.find(".details-network").addClass(c.network.toLowerCase());if(c.identity){d.find(".author").text(c.identity)}if(c.link!==undefined)d.find(".goto-link").attr("href",c.link);else d.find(".goto").remove()},expandedPopulateCallback:function(a){boxManager.genericRequest("/api/dataProvider/socials"+"/expand/"+a.id,{},a.context.genericCallbackEventWrapper(a.context.populateFields,a))},loadInboxData:function(){var a=this.getContentDom().find(".data-grid-holder table.data-grid");var b=a.find("tbody tr:first").clone().removeClass("odd even border");var c=a.find("tbody:first > tr:last").clone();var d=null;var e=null;a.find("tbody tr").remove();var f=this.data.socials;for(var g=0;g<f.length;g++){var h=f[g].id;e=c.clone().attr("data-row-id",h).bind("expand",this.genericCallbackEventWrapper(this.expandedPopulate,{context:this,id:h}));d=this.prepareMessage(b,f[g]);if(g%2){d.addClass("odd")}else{d.addClass("even")}var i=$('<input type="checkbox" name="id[]" value=""  />');i.attr("value",f[g].id);d.find("td.col-checkbox").html(i);a.children("tbody").append(d);a.children("tbody").append(e)}},construct:function(){this.noApiUrl=true}});boxManager={collection:{},section_id:null,dataProvider:null,range:null,positions:null,exporter:null,add:function(a){if(a instanceof BoxController&&a.getBoxId()&&a.endpoint&&a.getContentDom().length){if(!a.dataProvider&&this.dataProvider){a.setDataProvider(this.dataProvider)}this.collection[a.getBoxId()]=a}else{delete a}return this},getBox:function(a){if(this.collection[a]){return this.collection[a]}return false},droppable:function(a){return{accept:a,activeClass:"box-dropable",hoverClass:"box-drag-over",drop:function(a,b){var c=$(this),d=b.draggable.parent(),e={},f=$(this).attr("id"),g=d.attr("id");if(c.children().length>0){e[g]={box_id:$(c).children().attr("id"),location_id:1,box_class:d.attr("class")};e[f]={box_id:$(b.draggable).attr("id"),location_id:1,box_class:$(this).attr("class")};d.append(c.children())}else{e[f]={holder_id:f,box_id:$(b.draggable).attr("id"),location_id:1,box_class:$(this).attr("class"),section_id:boxManager.section_id};d.addClass("empty").removeClass("active")}$(this).append(b.draggable);$(this).removeClass("empty").addClass("active");if(!boxManager.positions[f]){e[f].delete_previous=true}boxManager.genericRequest("/api/box/move",$.param({holders:e}))}}},initDragAndDrop:function(){var a=this;$("#boxes-holder .box").draggable({snap:".box-container",snapMode:"inner",handle:".box-header-button-move",cursor:"move",helper:function(){return $("<div />",{css:{width:$(this).width()-14,background:"#fff",padding:"10px",border:"1px solid gray","font-size":"14px","font-weight":"bold",height:"30px"}}).text($(this).find(".box-header-title").text())},appendTo:"body",zIndex:10,start:function(a,b){var c=$(this).parent().is(".box-container-left, .box-container-right")?$(".box-container.empty.box-container-left, .box-container.empty.box-container-right"):$(".box-container.empty").not(".box-container-left, .box-container.empty.box-container-right");c.addClass("box-dropable")},stop:function(a,b){$(this).css({bottom:0,left:0,width:"auto"});$(".box-container.empty").removeClass("box-dropable")}});$(".box-container").each(function(){var b=$(this).is(".box-container-left, .box-container-right")?".box-container.box-container-left .box, .box-container.box-container-right .box":".box-container:not(.box-container-left, .box-container-right) .box";if(!$(this).children().length){$(this).removeClass("active").addClass("empty")}$(this).droppable(a.droppable(b))})},genericRequest:function(a,b,c){$.ajax({type:"POST",accepts:"application/json; charset=utf-8",data:b,dataType:"json",url:a,success:c})},initHolders:function(){var a=this,b={};b.holders=[];$(".box-container").each(function(){var c=a.section_id+"-"+$(this).index();$(this).addClass("hide");$(this).attr("id",c);if($(this).is(":parent")){b.holders.push({holder_id:this.id,box_id:$(this).find(".box").attr("id"),location_id:1,section_id:a.section_id,box_class:$(this).attr("class")})}});if($("#boxes-holder").length){this.genericRequest("/api/box/positions/"+this.section_id,$.param(b),function(b){a.positions=b;var c={};for(var d in b){var e=b[d],f=a.collection[e.box_id];if(!f){return}c[e.box_id]=true;box_holder=f.getBoxDom().parent();holder_id=box_holder.attr("id");if(holder_id!=e.holder_id){var g=$("#"+e.holder_id);var h=g.children();g.html(f.getBoxDom());g.removeClass("empty").addClass("active");box_holder.html(h)}f.init()}for(var i in boxManager.collection){if(c[i])continue;boxManager.collection[i].init()}a.initDragAndDrop();$(".box-container").removeClass("hide")})}},init:function(){this.section_id=$(".top-menu-item.active").text().toLowerCase().replace(/\s+/g,"_");this.initHolders();return this},moveEmptyToBottom:function(){var a=$("#boxes-holder");var b=$("#boxes-holder .box-container");b.each(function(b){var c=$(this);if(!c.children().length){if(c.hasClass("box-container-left")&&!c.next().hasClass("active")){var d=c.next();d.next(".clear").remove();a.append(c).append(d);a.append('<div class="clear"></div>')}else if(!c.hasClass("box-container-left")&&!c.hasClass("box-container-right")){c.nextAll(":last").after(c)}}});return this},refresh:function(){for(i in this.collection){this.collection[i].refresh()}return this},setDataProvider:function(a){this.dataProvider=a;for(var b in this.collection){this.collection[b].setDataProvider(a)}return this},setExporter:function(a){this.exporter=a;return this},setFilter:function(a){for(i in this.collection){this.collection[i].setFilter(a)}return this},setRange:function(a){this.range=a;for(i in this.collection){this.collection[i].setRange(this.range)}return this},setDateInterval:function(a){for(i in this.collection){this.collection[i].setDateInterval(a)}return this},clearData:function(){for(i in this.collection){this.collection[i].clearData()}return this},exportBoxes:function(a){if(!a){a=null}$("#boxes-holder .box-container .box").each(function(){var a,b,c=boxManager.getBox(this.id);if(!c||c.ignore)return;if(!c.getBoxDom().parent().is(".box-container-left, .box-container-right")){a=Exporter.template.blockWide.clone()}else{a=Exporter.template.block.clone().addClass(c.getBoxDom().parent().attr("class"))}if(c.hasOwnProperty("graph")&&(c.getHeaderDom().find(".box-header-button-show-graph.active").length||c.getContentDom().children().length==1)){var d=a.clone();var e=c.graph.getSVG();var f=$("<h2/>").text(c.getHeaderDom().find(".box-header-title").text());f.add(e).appendTo(d.find(".inner"));d.appendTo(boxManager.exporter.template.container)}else{b=c.getContentDom().find(".data-grid-holder table:visible:first").clone();if(!b.length&&this.id=="box-ogsi"){b=c.getBoxDom().clone();b.find(".box-header").remove()}b.find("tr.expanded").remove();b.find("td").removeAttr("style");if(b.length){var g=$("<h2/>").text(c.getHeaderDom().find(".box-header-title").text());g.add(b).appendTo(a.find(".inner"));a.appendTo(boxManager.exporter.template.container);if(c.getBoxDom().parent().is(".box-container-right")){$('<div class="clear"/>').appendTo(boxManager.exporter.template.container)}}}});boxManager.exporter.submit(a)}};$(document).ready(function(){boxManager.add(new BC_TagsAnalysis).add(new BC_Scoreboard).add(new BC_ScoreboardCurrent).add(new BC_ReviewSites).add(new BC_ReviewInbox).add(new BC_SocialActivity).add(new BC_SocialSubscribers).add(new BC_SocialMediaInbox).add(new BC_CompetitionDistribution).add(new BC_CompetitionComparision).add(new BC_CompetitionReviewInbox).add(new BC_CompetitionScore).add(new BC_StatusUpdate).add(new BC_RecentActivity).setDataProvider(new DataProvider).setExporter(Exporter)});var Exporter={options:{action:"/api/box/export",width:380},template:{block:$('<div class="block"><div class="inner"></div></div>'),blockWide:$('<div class="block2"><div class="inner"></div></div>'),container:$('<div id="page"></div>')},submit:function(a){var b=Highcharts;var c=this;var d=b.merge(this.options,b.getOptions()["exporting"]);var e=b.createElement("form",{method:"POST",action:d.action},{display:"NONE"},document.body);b.createElement("input",{type:"HIDDEN",name:"html",value:c.template.container.html()},null,e);if(a&&a["emails"]){$.post("/api/box/export",{html:c.template.container.html(),email:a["emails"]},function(){a.callback()})}else e.submit();b.discardElement(e);this.template.container=$('<div id="page"></div>')}};Site={sites:[],init:function(){this.sites.push({site:"dealerrater.com",isResponse:true,url:"http://www.dealerrater.com/login.aspx"});this.sites.push({site:"mydealerreport.com",isResponse:true,url:"http://www.mydealerreport.com/dealers/index.php"});this.sites.push({site:"edmunds.com",isResponse:true,url:"http://www.edmunds.com/era/secure/lb/login.jsp?toUrl=http%3A%2F%2Fwww.edmunds.com%2F"});this.sites.push({site:"maps.google.com",isResponse:true,url:"https://www.google.com/accounts/ServiceLogin?service=lbc"});this.sites.push({site:"citysearch.com",isResponse:true,url:"http://www.citysearch.com/members/start"});this.sites.push({site:"insiderpages.com",isResponse:true,url:"http://www.insiderpages.com/session/new?header_link=true"});this.sites.push({site:"local.yahoo.com",isResponse:true,url:"https://login.yahoo.com/"});this.sites.push({site:"judysbook.com",isResponse:true,url:"http://www.judysbook.com/login"});this.sites.push({site:"yp.com",isResponse:true,url:"http://www.yellowpages.com/oauth/login?url=%2Flogin_success"});this.sites.push({site:"yelp.com",isResponse:true,url:"https://www.yelp.com/login"});this.sites.push({site:"tripadvisor.com",isResponse:true,url:"http://www.tripadvisor.com/"});this.sites.push({site:"urbanspoon.com",isResponse:true,url:"http://www.urbanspoon.com/u/signin?"});this.sites.push({site:"zagat.com",isResponse:false,url:""})},check:function(a){if(!this.sites.length)this.init();for(var b=0,c=this.sites.length;b<c;b++){if(this.sites[b].site==a)return this.sites[b].isResponse?this.sites[b].url:false}return false}}